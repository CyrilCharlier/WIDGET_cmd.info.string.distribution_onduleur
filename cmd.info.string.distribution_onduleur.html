<div class="cmd #history# cmd-widget" data-type="info" data-subtype="string" data-cmd_id="#id#" data-cmd_uid="#uid#" data-version="#version#" data-eqLogic_id="#eqLogic_id#" style="width: 100%;">
<!-- ################ Distribution onduleur ################ 
  Widget name : cmd.info.string.distribution_onduleur
  Author : Phpvarious
  Inspiration : https://github.com/slipx06/sunsynk-power-flow-card/tree/master
  Last Uptade : 2023/09/09 - Phpvarious -> Création.

  ###### TODO ######
    --inverterStateColour // Todo attribuer une fonction
    Param optionnel sur les couleurs.
    PV voltage & current
    icon sur load
    minimum de batterie autre que 0%
-->
  <div class="widget#id#" id="widget#id#"></div>
  <style>
    :root {
      --solar_colour#id# : orange;
      --battery_colour#id# : pink;
      --grid_colour#id# : #5490c2;
      --load_colour#id# : #5fb6ad;
      --inverter_colour#id# : grey;
      --inverterStateColour#id#: transparent;
      --background#id#: transparent;
      --no_grid_colour#id#: #a40013;
    }
    .widget#id#{
    position: absolute;
    width: 100%;
    }
    .container#id# {
    /* display: flex; */
    /* flex-direction: column;*/
    /*align-items: center;*/
    justify-content: center;
    height: 100%;
    width: 100%;
    /*padding: 5px;*/
    }
    .card#id# {
    /*border-radius: var(--ha-card-border-radius, 10px);
    box-shadow: var(--ha-card-box-shadow, 0px 0px 0px 1px rgba(0, 0, 0, 0.12), 0px 0px 0px 0px rgba(0, 0, 0, 0.12), 0px 0px 0px 0px rgba(0, 0, 0, 0.12));*/
    background: var(--background#id#, transparent);
    /*border-width: var(--ha-card-border-width);*/
    /*padding: 0px;*/
    }
    .left-align#id# {text-anchor: start;}
    .right-align#id# {text-anchor: end;}
    .center-align#id# {text-anchor: middle;}
    /* .st1{fill:#ff9b30;} */
    /* .st2{fill:#f3b3ca;} */
    .st3#id#{font-size:9px;}
    .st4#id#{font-size:14px;}
    /* .st5{fill:#969696;} */
    /* .st6{fill:#5fb6ad;} */
    /* .st7{fill:#5490c2;} */
    .st8#id#{font-weight:500}
    /* .st9{fill:#959595;} */
    .st10#id#{font-size:16px;}
    /*.st11{fill:transparent;}*/
    .st12#id#{display:none;}
    .st13#id#{font-size:22px;}
    .st14#id#{font-size:12px;}
    .st13#id#{font-size:18px;}
    
    .essload-icon#id# {
          color: var(--load_colour#id#) !important;
          /* --mdc-icon-size: 32px; */
        }
  </style>
  <script>
    var debug#id# = ('#debug#' == 1) ? true : false;
    var fullJs#id# = false
    var jeedomVersion#id# = 4.4
    var versionWidget#id# = '09/09/2023 22h30'
    
    if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] Compatibilité V4.3 V4.4 [' + versionWidget#id# + '] ───────────────')
    /* Compatibilité V4.2 V4.3 V4.4 */
    /**/ if(typeof jeeFrontEnd === 'undefined') {
    /**/   if (debug#id#) console.log('| jeeFrontEnd no exist -> version <= 4.2')
    /**/   jeedomVersion#id# = 4.2
    /**/ }
    /**/ else
    /**/ {
    /**/   jeedomVersion#id# = jeeFrontEnd.jeedomVersion.substr(0, 3)
    /**/   if (debug#id#) console.log('| jeeFrontEnd -> version == ' + jeedomVersion#id#)
    /**/ }
    /**/ if (jeedomVersion#id# >= 4.4) {
    /**/   fullJs#id# = true
    /**/   if (debug#id#) console.log('| Full Js')
    /**/ }
    /**/ if (typeof jeedom.cmd.addUpdateFunction !== 'function') { // a partir de la 4.3
    /**/   if (debug#id#) console.log('| jeedom.cmd.addUpdateFunction no exist')
    /**/   jeedom.cmd.addUpdateFunction = function(id,func) { jeedom.cmd.update[id]=func; }
    /**/ }
    /* ------------------------------------------ */
    
    
    ////////////////////////// FUNCTION /////////////////////////
    var unite_conversion#id# = {
      'W' : [1000, 'W', 'kW', 'MW'],
      'Wh' : [1000, 'Wh', 'kWh', 'MWh'],
      'l' : [1000, 'l', 'm<sup>3</sup>']
    }
    
    function autoValueArray#id#(value, unit = '', trunc = 1, round = false) {
      var result = { }
      result.unit = unit.replace("\"", "").replace("\'", "")
      if (value === null || value == '') {
        result.value = 0
        return result
      }
      if(isNaN(value) == true){
        result.value = value
        return result
      }
      if (round && round >= 0 && !isNaN(round)) {
        //value = value.toFixed(round)
        //if (value == 0) {
         // result.value = 0
         // return result 
        //}
      }
      if (isset(unite_conversion#id#[unit])) {
        let mod = unite_conversion#id#[unit][0]
        let prefix = unite_conversion#id#[unit].slice(1)
        let myval = autoValueFormat#id#(value, mod, prefix.length - 1)
        //result.value = Math.trunc(myval[0] * trunc) / trunc
        //result.value = Math.trunc((myval[0] * trunc).toPrecision(5)) / trunc
        result.value = myval[0]
        result.unit = prefix[myval[1]]
      } else result.value = value //result.value = Math.trunc(value * trunc) / trunc
      return result
    }
    
    function autoValueFormat#id#(value, mod = 1000, maxdiv = 10) {
      let val = 0
      if (value < 0) {
        val = parseFloat(-value)
      } else {
        val = parseFloat(value)
      }
      for (div = 0; div < maxdiv && val >= mod; div++) {
        val = parseFloat(val / mod)
      }
      if (value < 0) {
        val = -val;
      }
      return Array(val, div)
    }
    
    function getBatteryIcon#id#(value=false, full_capacity=80, empty_capacity=30) {
        if (debug#id#) console.log('| getBatteryIcon() -> ' + value + ' | ' + full_capacity + ' | ' + empty_capacity)
      if (value < full_capacity && value >= 50) {
          return '<path fill="var(--battery_colour#id#)" d="M 12 20 H 4 V 6 h 8 L 12 20 m 0.67 -16 H 11 V 2 H 5 v 2 H 3.33 C 2.6 4 2 4.6 2 5.33 v 15.34 C 2 21.4 2.6 22 3.33 22 h 9.34 c 0.74 0 1.33 -0.59 1.33 -1.33 V 5.33 C 14 4.6 13.4 4 12.67 4 M 11 16 H 5 v 3 h 6 v -3 m 0 -4.5 H 5 v 3 h 6 v -3 h -3 h 3"/>';
        } else if (value < 50 && value >= empty_capacity) {
          return '<path fill="var(--battery_colour#id#)" d="M 12 20 H 4 V 6 h 8 L 12 6 L 12 20 m 0.67 -15.999 H 11 V 2 H 5 v 2 H 3.33 C 2.6 4 2 4.6 2 5.33 v 15.34 C 2 21.4 2.6 22 3.33 22 h 9.34 c 0.74 0 1.33 -0.59 1.33 -1.33 V 5.33 C 14 4.6 13.4 4 12.67 4 M 11 16 H 5 v 3 h 6 v -3"/>';
        } else if (value < empty_capacity) {
          return '<path fill="var(--battery_colour#id#)" d="M 12 6 L 12 20 M 12 20 H 4 l 0.05 -14 h 7.95 m 0.67 -2 h -1.67 V 2 h -6 v 2 H 3.38 a 1.33 1.33 0 0 0 -1.33 1.33 v 15.34 c 0 0.73 0.6 1.33 1.33 1.33 h 9.34 c 0.73 0 1.33 -0.6 1.33 -1.33 V 5.33 A 1.33 1.33 0 0 0 12.72 4 Z"/>';
        } else {
          return '<path fill="var(--battery_colour#id#)" d="M 12 20 H 4 V 6 h 8 L 12 20 m 0.67 -16 H 11 V 2 H 5 v 2 H 3.33 C 2.6 4 2 4.6 2 5.33 v 15.34 C 2 21.4 2.6 22 3.33 22 h 9.34 c 0.74 0 1.33 -0.59 1.33 -1.33 V 5.33 C 14 4.6 13.4 4 12.67 4 M 11 16 H 5 v 3 h 6 v -3 m 0 -9 H 5 v 3 h 6 V 7 m 0 4.5 H 5 v 3 h 6 v -3 h -3 h 3"/>';
        }
    }
    
    
    ////////////////////////// Config /////////////////////////
    var config#id# = {
      panel_mode: true, // rester a true pour que l'user puisse choisir la taille
      large_font: false,// Todo -> param optionnel
      show_solar: false,//
      card_height: '396px',
      timer: {
        usetimer: false, /* Displays "Use timer" status as an icon next to the inverter. Set to `no` to hide */
        state: 'no', // [on, off] Shows if energy pattern is set to priority load or priority battery as an icon next to the inverter.
        text_on: 'Timer on',
        text_off: 'Timer off'
      },
      priority: {
        usepriority: false, //--------------- Todo
        state: 'off', // on, off 
        text_on: 'Priority Load',
        text_off: 'Priority Batt'
      },
      inverter: {
        modern: true, // Todo -> param optionnel
        autarky: 'no', // no, energy, power
        autarky_state: 10, // affiché si autarky = energy
        autarkyp_state: 20, // affiché si autarky = power
        ratio_state: 30, // affiché si autarky = energy
        ratiop_state: 40, // affiché si autarky = power
        autarky_text: 'Autarky', // affiché si autarky != no
        ratio_text:'Ratio', // affiché si autarky != no
        //model: 'sunsynk',
        voltage_state: false,
        voltage_unite: 'V',
        frequency_state: false,
        frequency_unite: 'Hz',
        current_state: false,
        current_unite: 'A',
        temp:{
          ac_state: false,
          ac_unite: '',
          dc_state: false,
          dc_unite: ''
        },
        prog: { //--------------- Todo
          show: false,
          charge: 'none', // 'none'
          grid: '', //none
          capacity: 100
        }
      },
      battery: {
        animation_speed: 5, //
        //max_power: false,
        energy: false, 
        //duration: '11.8 Hrs',
        voltage_state: false,
        voltage_unite: 'V',
        current_state: false,
        current_unite: 'A',
        power_state: 0,
        power_unite: 'W',
        daily: {
          show_charge: false,//
          show_discharge: false,//
          charge_state: 0,
          discharge_state: 0,
          charge_unite: '',
          discharge_unite: '',
          //text_charge: 'DAILY CHARGE',
          text_charge: 'CHARGE JOUR',
          //text_discharge: 'DAILY DISCHARGE',
          text_discharge: 'DECHARGE JOUR',
        },
        full_capacity: 86.3, // Todo -> param optionnel
        empty_capacity: 20, // Todo -> param optionnel
        soc: {
          show: false,//
          state: 100, //
          shutdown: 0
        },
        temp: {
          show: false,//
          state: 0,//
          unite: '°' //
        }
      },
      solar: {
        animation_speed: 5,
        max_power: false,
        daily: {
          show: true, //
          state: 0,
          unite: '', //
          text: 'PROD JOUR',
          //text: 'DAILY SOLAR',
          text_left: 'DAILY SOLAR / LEFT TODAY',
          remaining_show: false,
          remaining_state: 0,
          remaining_unite: 'T'
        },
        mppts: 0, // ok
        pv1_name: '',
        pv2_name: '',
        pv3_name: '',
        pv4_name: '',
        pv1_state: 0, // ok
        pv2_state: 0, // ok
        pv3_state: 0, // ok
        pv4_state: 0, // ok
        unite: 'W', // ok
        sell: 'undefined', // on, off, 1, 0, undefined // Todo        
      },
      load: {
        animation_speed: 5,//
        max_power: false,
        daily:{
          show: false,//
          text: 'CONSO JOUR',
          //text: 'DAILY LOAD',
          state: 0, //
          unite: '',
        },
        additional_loads: 0,//
        aux: {
          //show_aux: true,
          //show_daily_aux: false,
          //invert_aux: false,
          //aux_name: 'Aux load 1',
          //aux_type: 'default',
          //aux_loads: 0,
        //aux_load1_name: '',
        //aux_load2_name: '',
        },
        has_load_power: false,
        load_state: 0,
        load_unite: 'W',
        load1_state: 0,
        load1_unite: 'W',
        load1_icon: 'default', //oven, pump, aircon, boiler
        load1_name: false, // 
        load2_state: 0,
        load2_unite: 'W',
        load2_icon: 'default', //oven, pump, aircon, boiler
        load2_name: false, //
      },
      grid: {
        animation_speed: 5,
        max_power: false,
        daily: {
          show_sell: false, //
          show_buy: false, //
          buy_state: 0,//
          buy_unite: '',//
          sell_state: 0,//
          sell_unite: '',//
          //text_sell: 'DAILY GRID SELL',
          text_sell: 'VENTE JOUR',
          //text_buy: 'DAILY GRID BUY'
          text_buy: 'ACHAT JOUR'
        },
        energy_cost: false,
        power_state: 0,
        power_unite:'W',
        status: 1, // on, off, '0', 0, '1', 1
        noness: {
          //show_nonessential: true,
          //nonessential_icon: 'default',
          //nonessential_name: 'nonessential_name',
          //additional_loads: 2,
          //load1_name: 'common.load1', //
          //load2_name: 'common.load2', //
          //load1_icon: 'default',
          //load2_icon: 'default',
        },
        //invert_grid: false,           
      },
    }
    
    ////////////////////////// Général /////////////////////////
    if ('#Background#' != '#'+'Background#') document.documentElement.style.setProperty('--background#id#', '#Background#')
    //var sizeWidget#id# = 396
    //if (is_numeric('#Size#')) {
      //sizeWidget#id# = ('#Size#' < 200) ? 200 : ('#Size#' > 1500) ? 1500 : '#Size#'
    //}
    ////////////////////////// Solar /////////////////////////
    if ('#pv1Name#' != '#'+'pv1Name#') config#id#.solar.pv1_name = '#pv1Name#'
    if ('#pv2Name#' != '#'+'pv2Name#') config#id#.solar.pv2_name = '#pv2Name#'
    if ('#pv3Name#' != '#'+'pv3Name#') config#id#.solar.pv3_name = '#pv3Name#'
    if ('#pv4Name#' != '#'+'pv4Name#') config#id#.solar.pv4_name = '#pv4Name#'
    if (is_numeric('#pvMaxPower#')) config#id#.solar.max_power = '#pvMaxPower#'
    if ('#dailySolarText#' != '#'+'dailySolarText#') config#id#.solar.daily.text = '#dailySolarText#'
    if ('#load1Name#' != '#'+'load1Name#') config#id#.load.load1_name = '#load1Name#'
    if ('#load2Name#' != '#'+'load2Name#') config#id#.load.load2_name = '#load2Name#'
    if ('#dailyLoadText#' != '#'+'dailyLoadText#') config#id#.load.daily.text = '#dailyLoadText#'
    if (is_numeric('#loadMaxPower#')) config#id#.load.max_power = '#loadMaxPower#'
    if ('#dailyGridSellText#' != '#'+'dailyGridSellText#') config#id#.grid.daily.text_sell = '#dailyGridSellText#'
    if ('#dailyGridBuyText#' != '#'+'dailyGridBuyText#') config#id#.grid.daily.text_buy = '#dailyGridBuyText#'
    if (is_numeric('#gridMaxPower#')) config#id#.grid.max_power = '#gridMaxPower#'
    if ('#dailyBatteryChargeText#' != '#'+'dailyBatteryChargeText#') config#id#.battery.daily.text_charge = '#dailyBatteryChargeText#'
    if ('#dailyBatteryDischargeText#' != '#'+'dailyBatteryDischargeText#') config#id#.battery.daily.text_discharge = '#dailyBatteryDischargeText#'
    if (is_numeric('#batteryMaxPower#')) config#id#.battery.energy = '#batteryMaxPower#'
    
    // lite
    
    ///////////////// TODO ////////////////////
    var float = false
    //var battery_capacity = 123
    //var localize_common_runtime_to = 'TO'
    //var localize_common_to = 'TO'
    //var localize_common_charge = 'CHARGE'
    //var localize_common_battery_floating = 'BATTERY FLOATING'
    //var formattedResultTime = 'test'
    //var duration = '4 hrs, 12 min'
    // -----------------------------------
    //var load1e_icon = 'oven' //oven, pump, aircon, boiler
    //var load2e_icon = 'oven' //oven, pump, aircon, boiler
    
    var pv1_voltage_state = 0
    var pv1_current_state = 0
    var pv2_voltage_state = 0
    var pv2_current_state = 0
    var pv3_voltage_state = 0
    var pv3_current_state = 0
    var pv4_voltage_state = 0
    var pv4_current_state = 0
    
    var pv1_voltage = false
    var pv1_current = false
    var pv2_voltage = false
    var pv2_current = false
    var pv3_voltage = false
    var pv3_current = false
    var pv4_voltage = false
    var pv4_current = false
    
    var timer_in#id# = false
    ///////////////////////////////////////////
    
    
    jeedom.eqLogic.getCmd({
      id: '#eqLogic_id#',
      async: false,
      success: function (cmds) {
        //console.table(cmds)
        for (j in cmds) {
          
          cmds[j].name = cmds[j].name.toLowerCase();
          cmds[j].name = cmds[j].name.replace(/é/g, 'e');
          cmds[j].name = cmds[j].name.replace(/_/g, ' ');
          //if (debug#id# == 1) console.log('| ' + cmds[j].id + ' - ' + cmds[j].type+" - "+cmds[j].name+" - Min:"+cmds[j].configuration.minValue+" - Max:"+cmds[j].configuration.maxValue);
          let id_eql = cmds[j].id;
          let name = cmds[j].name
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////////  pv1 power ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          if (cmds[j].name == 'pv1 power'){
            if (debug#id# == 1) console.log('| pv1_power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(pv1Value) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + pv1Value)
                config#id#.show_solar = true
                config#id#.solar.mppts = 1
                if (typeof pv1Value === "number") config#id#.solar.pv1_state = pv1Value
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                config#id#.solar.pv1_state = _options.value
                document.getElementById("pv1_power_state#id#").innerHTML = config#id#.solar.pv1_state + ' ' + config#id#.solar.unite
                calculatePv#id#('pv1_power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////////  pv2 power ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'pv2 power'){
            //config#id#.show_solar = true
            if (debug#id# == 1) console.log('| pv2_power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(pv2Value) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + pv2Value)
                config#id#.solar.mppts = 2
                if (typeof pv2Value === "number") {
                  config#id#.solar.pv2_state = pv2Value
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                config#id#.solar.pv2_state = _options.value
                document.getElementById("pv2_power_state#id#").innerHTML = config#id#.solar.pv2_state + ' ' + config#id#.solar.unite
                calculatePv#id#('pv2_power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////////  pv3 power ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'pv3 power'){
            //config#id#.show_solar = true
            if (debug#id# == 1) console.log('| pv3_power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(pv3Value) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + pv3Value)
                config#id#.solar.mppts = 3
                if (typeof pv3Value === "number") {
                  //config#id#.show_solar = true
                  config#id#.solar.pv3_state = pv3Value
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                config#id#.solar.pv3_state = _options.value
                document.getElementById("pv3_power_state#id#").innerHTML = config#id#.solar.pv3_state + ' ' + config#id#.solar.unite
                calculatePv#id#('pv3_power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////////  pv4 power ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'pv4 power'){
            //config#id#.show_solar = true
            if (debug#id# == 1) console.log('| pv4_power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(pv4Value) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + pv4Value)
                config#id#.solar.mppts = 4
                if (typeof pv4Value === "number") {
                  //config#id#.show_solar = true
                  config#id#.solar.mppts = 4
                  config#id#.solar.pv4_state = pv4Value
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                config#id#.solar.pv4_state = _options.value
                document.getElementById("pv4_power_state#id#").innerHTML = config#id#.solar.pv4_state + ' ' + config#id#.solar.unite
                calculatePv#id#('pv4_power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////////  Daily Solar ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'daily solar'){
            config#id#.solar.daily.show = true
            if (debug#id# == 1) console.log('| daily solar')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailySolarValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailySolarValue)
                config#id#.solar.daily.unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.solar.daily.unite)
                if (typeof dailySolarValue === "number") {
                  config#id#.solar.daily.state = dailySolarValue
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailySolar = autoValueArray#id#(_options.value,config#id#.solar.daily.unite)
                document.getElementById("daily_solar_value#id#").innerHTML = dailySolar.value.toFixed(1) + ' ' + dailySolar.unit
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////  Battery State ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'battery state'){
            if (debug#id# == 1) console.log('| battery state')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(batteryStateValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + batteryStateValue)
                config#id#.battery.soc.show = true
                if (typeof batteryStateValue === "number") {
                  config#id#.battery.soc.state = batteryStateValue
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                
                config#id#.battery.soc.state = parseFloat(_options.value)
                //document.getElementById("icon_bat#id#").innerHTML = getBatteryIcon#id#(_options.value, config#id#.battery.full_capacity, config#id#.battery.empty_capacity)
                //document.getElementById("battery_soc#id#").innerHTML = parseInt(_options.value) + '%'
                calculateBattery#id#('battery state')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////  Battery Temp ////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'battery temp'){
            if (debug#id# == 1) console.log('| battery temp')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(batteryTempValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + batteryTempValue)
                if (cmds[j].unite != '') config#id#.battery.temp.unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.temp.unite)
                if (typeof batteryTempValue === "number") {
                  config#id#.battery.temp.show = true
                  config#id#.battery.temp.state = batteryTempValue.toFixed(1)
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                //document.getElementById("icon_bat#id#").innerHTML = getBatteryIcon#id#(_options.value, config#id#.battery.full_capacity, config#id#.battery.empty_capacity)
                document.getElementById("battery_temp#id#").innerHTML = _options.value.toFixed(1) + '' + config#id#.battery.temp.unite
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          /////////////////////////  Daily Battery Charge ///////////////////////
          ///////////////////////////////////////////////////////////////////////
         else if (cmds[j].name == 'daily battery charge'){
            config#id#.battery.daily.show_charge = true
            if (debug#id# == 1) console.log('| daily battery charge')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailyBatteryChargeValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailyBatteryChargeValue)
                config#id#.battery.daily.charge_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.daily.charge_unite)
                if (typeof dailyBatteryChargeValue === "number") {
                  config#id#.battery.daily.charge_state = dailyBatteryChargeValue
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailyBatteryCharge = autoValueArray#id#(_options.value,config#id#.battery.daily.charge_unite)
                document.getElementById("daily_bat_charge_value#id#").innerHTML = dailyBatteryCharge.value.toFixed(1) + ' ' + dailyBatteryCharge.unit
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////  Daily Battery Discharge //////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'daily battery discharge'){
            config#id#.battery.daily.show_discharge = true
            if (debug#id# == 1) console.log('| daily battery discharge')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailyBatteryDischargeValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailyBatteryDischargeValue)
                config#id#.battery.daily.discharge_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.daily.discharge_unite)
                if (typeof dailyBatteryDischargeValue === "number") {
                  config#id#.battery.daily.discharge_state = dailyBatteryDischargeValue
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailyBatteryDischarge = autoValueArray#id#(_options.value,config#id#.battery.daily.discharge_unite)
                document.getElementById("daily_bat_discharge_value#id#").innerHTML = dailyBatteryDischarge.value.toFixed(1) + ' ' + dailyBatteryDischarge.unit
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Battery Voltage //////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'battery voltage'){
            //config#id#.battery.daily.show_discharge = true
            if (debug#id# == 1) console.log('| battery voltage')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(batteryVoltage) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + batteryVoltage)
                config#id#.battery.voltage_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.voltage_unite)
                if (typeof batteryVoltage === "number") {
                  config#id#.battery.voltage_state = batteryVoltage.toFixed(1)
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                //let batteryVoltage = autoValueArray#id#(_options.value,config#id#.battery.voltage_unite)
                //document.getElementById("battery_voltage#id#").innerHTML = batteryVoltage.value.toFixed(1) + ' ' + batteryVoltage.unit
                document.getElementById("battery_voltage#id#").innerHTML = _options.value.toFixed(1) + ' ' + config#id#.battery.voltage_unite
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Battery Current //////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'battery current'){
            //config#id#.battery.daily.show_discharge = true
            if (debug#id# == 1) console.log('| battery current')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(batteryCurrent) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + batteryCurrent)
                config#id#.battery.current_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.current_unite)
                if (typeof batteryCurrent === "number") {
                  config#id#.battery.current_state = batteryCurrent.toFixed(1)
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                //let batteryVoltage = autoValueArray#id#(_options.value,config#id#.battery.voltage_unite)
                //document.getElementById("battery_voltage#id#").innerHTML = batteryVoltage.value.toFixed(1) + ' ' + batteryVoltage.unit
                document.getElementById("battery_current#id#").innerHTML = _options.value.toFixed(1) + ' ' + config#id#.battery.current_unite
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          /////////////////////////////  Battery Power //////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'battery power'){
            //config#id#.battery.daily.show_discharge = true
            if (debug#id# == 1) console.log('| battery power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(batteryPower) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + batteryPower)
                config#id#.battery.power_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.battery.power_unite)
                if (typeof batteryPower === "number") {
                  config#id#.battery.power_state = batteryPower.toFixed(0)
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let batteryPower = (_options.value > 0) ? _options.value : (_options.value < 0) ? (_options.value * -1) : _options.value
                //document.getElementById("battery_voltage#id#").innerHTML = batteryVoltage.value.toFixed(1) + ' ' + batteryVoltage.unit
                document.getElementById("battery_power#id#").innerHTML = batteryPower.toFixed(0) + ' ' + config#id#.battery.power_unite
                if(_options.value > 0) {
                  document.getElementById("power-dot-charge#id#").setAttribute("fill", "var(--battery_colour#id#)");
                  document.getElementById("power-dot-discharge#id#").setAttribute("fill", "transparent");
                }
                else if(_options.value < 0) {
                  document.getElementById("power-dot-charge#id#").setAttribute("fill", "transparent");
                  document.getElementById("power-dot-discharge#id#").setAttribute("fill", "var(--battery_colour#id#)");
                }
                else {
                  document.getElementById("power-dot-charge#id#").setAttribute("fill", "transparent");
                  document.getElementById("power-dot-discharge#id#").setAttribute("fill", "transparent");
                }
                config#id#.battery.power_state = batteryPower.toFixed(0)
                calculateBattery#id#('battery power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////  Daily Grid Buy //////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'daily grid buy'){
            config#id#.grid.daily.show_buy = true
            if (debug#id# == 1) console.log('| daily grid buy')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailyGridBuy) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailyGridBuy)
                config#id#.grid.daily.buy_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.grid.daily.buy_unite)
                if (typeof dailyGridBuy === "number") {
                  config#id#.grid.daily.buy_state = dailyGridBuy
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailyGridBuy = autoValueArray#id#(_options.value,config#id#.grid.daily.buy_unite)
                document.getElementById("daily_grid_buy_value#id#").innerHTML = dailyGridBuy.value.toFixed(1) + ' ' + dailyGridBuy.unit
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Daily Grid Sell //////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'daily grid sell'){
            config#id#.grid.daily.show_sell = true
            if (debug#id# == 1) console.log('| daily grid sell')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailyGridSell) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailyGridSell)
                config#id#.grid.daily.sell_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.grid.daily.sell_unite)
                if (typeof dailyGridSell === "number") {
                  config#id#.grid.daily.sell_state = dailyGridSell
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailySellBuy = autoValueArray#id#(_options.value,config#id#.grid.daily.sell_unite)
                document.getElementById("daily_grid_sell_value#id#").innerHTML = dailySellBuy.value.toFixed(1) + ' ' + dailySellBuy.unit
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ////////////////////////////  Grid Power //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'grid power'){
            if (debug#id# == 1) console.log('| grid power')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(gridPowerValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + gridPowerValue)
                config#id#.grid.power_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.grid.power_unite)
                if (typeof gridPowerValue === "number") {
                  config#id#.grid.power_state = gridPowerValue
                }
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                document.getElementById("grid_power#id#").innerHTML = (_options.value.toFixed(0)) + ' ' + config#id#.grid.power_unite
                if(_options.value > 0) {
                  document.getElementById("grid-dot-buy#id#").setAttribute("fill", "var(--grid_colour#id#)");
                  document.getElementById("grid-dot1-buy#id#").setAttribute("fill", "var(--grid_colour#id#)");
                  document.getElementById("grid-dot-sell#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot1-sell#id#").setAttribute("fill", "transparent");
                }
                else if(_options.value < 0) {
                  document.getElementById("grid-dot-buy#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot1-buy#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot-sell#id#").setAttribute("fill", "var(--grid_colour#id#)");
                  document.getElementById("grid-dot1-sell#id#").setAttribute("fill", "var(--grid_colour#id#)");
                }
                else {
                  document.getElementById("grid-dot-buy#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot1-buy#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot-sell#id#").setAttribute("fill", "transparent");
                  document.getElementById("grid-dot1-sell#id#").setAttribute("fill", "transparent");
                }
                config#id#.grid.power_state = _options.value
                calculateGrid#id#('grid power')
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Energy cost //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'energy cost'){
            if (debug#id# == 1) console.log('| energy cost')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(energyCost) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + energyCost)
                if (typeof energyCost === "number") {
                  config#id#.grid.energy_cost = energyCost.toFixed(2)
                }
                else config#id#.grid.energy_cost = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                document.getElementById("energy_cost#id#").innerHTML = _options.value.toFixed(2) + '€'
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Grid Status //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'grid status'){
            if (debug#id# == 1) console.log('| grid status')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(gridStatus) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + gridStatus)
                if (gridStatus === 0 || gridStatus === '0' || gridStatus === 'off') config#id#.grid.status = 0
                else config#id#.grid.status = 1
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value === 0 || _options.value === '0' || _options.value === 'off') {
                document.getElementById("transmission_on#id#").querySelector('path').classList.add("st12#id#");
                document.getElementById("transmission_off#id#").querySelector('path').classList.remove("st12#id#");
              }
              else {
                document.getElementById("transmission_on#id#").querySelector('path').classList.remove("st12#id#");
                document.getElementById("transmission_off#id#").querySelector('path').classList.add("st12#id#");
              }
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////////  AC Temp ///////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'ac temp'){
            if (debug#id# == 1) console.log('| ac temp')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(acTemp) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + acTemp)
                config#id#.inverter.temp.ac_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.inverter.temp.ac_unite)
                if (typeof acTemp === "number") {
                  config#id#.inverter.temp.ac_state = acTemp
                }
                else config#id#.inverter.temp.ac_state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              document.getElementById("ac_temp#id#").innerHTML = 'AC: ' + _options.value.toFixed(1) + ' ' + config#id#.inverter.temp.ac_unite
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////////  DC Temp ///////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'dc temp'){
            if (debug#id# == 1) console.log('| dc temp')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dcTemp) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dcTemp)
                config#id#.inverter.temp.dc_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.inverter.temp.dc_unite)
                if (typeof dcTemp === "number") {
                  config#id#.inverter.temp.dc_state = dcTemp
                }
                else config#id#.inverter.temp.dc_state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              document.getElementById("dc_temp#id#").innerHTML = 'DC: ' + _options.value.toFixed(1) + ' ' + config#id#.inverter.temp.dc_unite
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////  Voltage state /////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'voltage state'){
            if (debug#id# == 1) console.log('| voltage state')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(voltage) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + voltage)
                if (cmds[j].unite != '') config#id#.inverter.voltage_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.inverter.voltage_unite)
                if (typeof voltage === "number") {
                  config#id#.inverter.voltage_state = voltage.toFixed(1)
                }
                else config#id#.inverter.voltage_state = '0.0'
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              document.getElementById("inverter_voltage#id#").innerHTML = _options.value.toFixed(1) + ' ' + config#id#.inverter.voltage_unite
            })
          }
          ///////////////////////////////////////////////////////////////////////
          /////////////////////////  Frequency State /////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'frequency state'){
            if (debug#id# == 1) console.log('| frequency state')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(frequency) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + frequency)
                if (cmds[j].unite != '') config#id#.inverter.frequency_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.inverter.frequency_unite)
                if (typeof frequency === "number") {
                  config#id#.inverter.frequency_state = frequency.toFixed(1)
                }
                else config#id#.inverter.frequency_state = '0.0'
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              document.getElementById("inverter_frequency#id#").innerHTML = _options.value.toFixed(1) + ' ' + config#id#.inverter.frequency_unite
            })
          }
          ///////////////////////////////////////////////////////////////////////
          /////////////////////////  Current State //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'current state'){
            if (debug#id# == 1) console.log('| current state')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(current) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + current)
                if (cmds[j].unite != '') config#id#.inverter.current_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.inverter.current_unite)
                if (typeof current === "number") {
                  config#id#.inverter.current_state = current.toFixed(1)
                }
                else config#id#.inverter.current_state = '0.0'
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              document.getElementById("inverter_current#id#").innerHTML = _options.value.toFixed(1) + ' ' + config#id#.inverter.current_unite
            })
          }
          ///////////////////////////////////////////////////////////////////////
          ///////////////////////////  Load State ///////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'load state'){
            if (debug#id# == 1) console.log('| load state')
            config#id#.load.has_load_power = true
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(loadState) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + loadState)
                if (cmds[j].unite != '') config#id#.load.load_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.load.load_unite)
                if (typeof loadState === "number") {
                  config#id#.load.load_state = loadState
                }
                else config#id#.load.load_state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              config#id#.load.load_state = _options.value
              document.getElementById("ess_power#id#").innerHTML = parseInt(config#id#.load.load_state.toFixed(0)) + ' ' + config#id#.load.load_unite
              calculateLoad#id#('load state')
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////  Load 1 State //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'load1 state'){
            if (debug#id# == 1) console.log('| load1 state')
            config#id#.load.additional_loads = 1
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(load1State) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + load1State)
                if (cmds[j].unite != '') config#id#.load.load1_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.load.load1_unite)
                if (typeof load1State === "number") {
                  config#id#.load.load1_state = load1State
                }
                else config#id#.load.load1_state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              config#id#.load.load1_state = _options.value
              document.getElementById("ess_load1#id#").innerHTML = parseInt(config#id#.load.load1_state.toFixed(0)) + ' ' + config#id#.load.load1_unite
              if (config#id#.load.has_load_power === false) calculateLoad#id#('load1 state')
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////  Load 2 State //////////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'load2 state'){
            if (debug#id# == 1) console.log('| load2 state')
            config#id#.load.additional_loads = 2
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(load2State) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + load2State)
                if (cmds[j].unite != '') config#id#.load.load2_unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.load.load2_unite)
                if (typeof load2State === "number") {
                  config#id#.load.load2_state = load2State
                }
                else config#id#.load.load2_state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              config#id#.load.load2_state = _options.value
              document.getElementById("ess_load2#id#").innerHTML = parseInt(config#id#.load.load2_state.toFixed(0)) + ' ' + config#id#.load.load2_unite
              if (config#id#.load.has_load_power === false) calculateLoad#id#('load2 state')
            })
          }
          ///////////////////////////////////////////////////////////////////////
          //////////////////////////////  Daily Load ///////////////////////////
          ///////////////////////////////////////////////////////////////////////
          else if (cmds[j].name == 'daily load'){
            config#id#.load.daily.show = true
            if (debug#id# == 1) console.log('| daily load')
            jeedom.cmd.execute({
              id: id_eql,
              async: false,
              success:  function(dailyloadValue) {
                if (debug#id# == 1) console.log('|    └> cmd.execute : ' + dailyloadValue)
                config#id#.load.daily.unite = cmds[j].unite
                if (debug#id# == 1) console.log('|    └> unite : '  + config#id#.load.daily.unite)
                if (typeof dailyloadValue === "number") {
                  config#id#.load.daily.state = dailyloadValue
                }
                else config#id#.load.daily.state = 0
              }
            })
            jeedom.cmd.addUpdateFunction(cmds[j].id, function(_options) {
              if (debug#id# == 1) console.log('event for ' + name + '[' + id_eql + '] -> ' + _options.value)
              if (_options.value != undefined) 
              {
                let dailyload = autoValueArray#id#(_options.value,config#id#.load.daily.unite)
                document.getElementById("daily_load_value#id#").innerHTML = dailyload.value.toFixed(1) + ' ' + dailyload.unit
              }
            })
          }
          else {
            if (debug#id# == 1) {
              if (name != 'rafraichir' && name != 'widget') console.log('| ----------------> /!\\ le nom de la commande ' + name + '[' + id_eql + '] est inconnu')
            }
          }
          
        }
      }
    })
    if (debug#id#) console.log('└──────────────────────────────────────────────────────')
    
    init#id#(true)
    
  
    function init#id#(init=true,el='') {
      if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] en debug [init()] ───────────────')
      var ElDomExist = !!document.getElementById("widget#id#");
      if (debug#id#) console.log("| ElDomExist ?",ElDomExist);
      if (ElDomExist) {
        //if (debug#id#) console.log('| ┌──────────────────────── VALUES ──────────────────────')
        if (el != '' && debug#id#) console.log('| | launched by ' + el)
        
        
       
          
        
        if (init) {
         
          
          
          
    
    var html = '<div class="container#id# card#id#">';
    html += '<svg viewBox="-0.5'
    //html += '<svg viewBox="-7' //
    if (config#id#.show_solar === false) html += ' 145.33'
    else html += ' -0.5'
    html += ' 483'
    //html += ' 500'//
    if (config#id#.show_solar === false) html += ' 270.67'
    else html += ' 406'
    html += '" preserveAspectRatio="xMidYMid meet" height="'
    
    // height="${panel === false ? `${config#id#.show_solar === false ? '246px' : `${height}`}` : `${config#id#.show_solar === false ? '75%' : '100%'}`}"
    if (config#id#.panel_mode === false) {
      if (config#id#.show_solar === false) html += '246px'
      else html += config#id#.card_height
    } else if (config#id#.show_solar === false) html += '75%'
    else html += '100%'
    html += '" width="100%"  xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">'
    <!-- -->      
    html += '<rect x="204" y="300" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--battery_colour#id#)" pointer-events="all"></rect>'
          
          
    <!-- -->      
    html += '<rect x="304" y="203.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--load_colour#id#)" pointer-events="all"/>'
    html += '<rect x="205" y="116.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--solar_colour#id#)" pointer-events="all" class="'
    if (config#id#.show_solar === false || config#id#.solar.mppts == 1) html += 'st12#id#'
    html += '"/>'
    
    //html += '<rect x="269" y="329.75" width="70" height="70" rx="10.5" ry="10.5" fill="none" stroke="var(--battery_colour#id#)" pointer-events="all"/>' //159
    html += '<rect x="103" y="203.5" width="70" height="29.5" rx="4.42" ry="4.42" fill="none" stroke="var(--grid_colour#id#)" pointer-events="all"/>'
    
    // PV1
    html += '<rect id="pv1 "x="'
    html += (config#id#.solar.mppts == 1) ? '205' : '154'
    html += '" y="54.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--solar_colour#id#)" pointer-events="all" class="'
    if (config#id#.show_solar === false) html += 'st12#id#'
    html += '"/>'
    
    // PV2
    html += '<rect id="pv2 "x="254" y="54.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--solar_colour#id#)" pointer-events="all" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'st12#id#' : ''
    html += '"/>'
    
    // PV3
    html += '<rect id="pv3" x="78" y="54.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--solar_colour#id#)" pointer-events="all" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'st12#id#' : ''
    html += '"/>'
    
    // PV4
    html += '<rect id="pv4" x="330" y="54.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--solar_colour#id#)" pointer-events="all" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'st12#id#' : ''
    html += '"/>'
    
    html += '<rect id="es-load1#id#" x="406" y="116.5" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--load_colour#id#)" pointer-events="all" display="'
    html += ((config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2) && config#id#.show_solar !== false) ? '' : 'none'
    html += '"/>'
    
    html += '<rect id="es-load2#id#" x="406" y="290" width="70" height="30" rx="4.5" ry="4.5" fill="none" stroke="var(--load_colour#id#)" pointer-events="all" display="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar !== false) ? '' : 'none'
    html += '"/>'
    
    html += '<text id="duration#id#" x="270" y="377.5" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' left-align#id#" fill="'
    html += (config#id#.battery.energy == 0 || !config#id#.battery.energy) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '" ></text>'
    //html += (config#id#.battery.energy === 0 || config#id#.battery.power_state === 0) ? 'transparent' : 'var(--battery_colour#id#)'
    //html += '" >' + config#id#.battery.duration + '</text>'
          
    html += '<text id="duration_text_etat#id#" x="270" y="393.7" class="st3#id# left-align#id#" fill="'
    html += (config#id#.battery.energy == 0 || !config#id#.battery.energy || config#id#.battery.power_state === 0 || float === true) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '" ></text>'
    
    
    //html += '<text id="duration_text" x="290" y="393.7" class="st3#id# left-align#id#" fill="'
    //html += (config#id#.battery.energy === 0 || config#id#.battery.power_state <= 0 || float === true) ? 'transparent' : 'var(--battery_colour#id#)'
    //html += '" >' + localize_common_runtime_to + ' ' + battery_capacity + '% @' + formattedResultTime + '</text>'
    //html += '" >RUNTIME TO ' + battery_capacity + '% @' + formattedResultTime + '</text>'
    
    //html += '<text id="duration_text_charging" x="290" y="393.7" class="st3#id# left-align#id#" fill="'
    //html += (config#id#.battery.energy === 0 || config#id#.battery.power_state >= 0 || float === true) ? 'transparent' : 'var(--battery_colour#id#)'
    //html += '" >' + localize_common_to + ' ' + battery_capacity + '% ' + localize_common_charge + ' @ ' +formattedResultTime + '</text>'
    
    //html += '<text id="floating" x="290" y="393.7" class="st3#id# left-align#id#" fill="'
    //html += (config#id#.battery.energy === 0 || float === false) ? 'transparent' : 'var(--battery_colour#id#)'
    //html += '" >' + localize_common_battery_floating + '</text>'
    
    html += '<text id="daily_bat_charge#id#" x="135" y="357.2" class="st3#id# left-align#id#"  fill="' //77.2
    html += (config#id#.battery.daily.show_charge !== true) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '" >' + config#id#.battery.daily.text_charge + '</text>'
    
    html += '<text id="daily_bat_discharge#id#" x="135" y="393.7" class="st3#id# left-align#id#"  fill="' //77.2
    html += (config#id#.battery.daily.show_discharge !== true) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '" >' + config#id#.battery.daily.text_discharge + '</text>'
    
    html += '<text id="daily_load#id#" x="'
    html += (config#id#.load.additional_loads === 2) ? '365' : '400.4'
    html += '" y="'
    html += (config#id#.load.additional_loads === 2) ? '182.2' : '282.1'
    html += '" class="st3#id# left-align#id#" fill="'
    html += (config#id#.load.daily.show === false) ? 'transparent' : 'var(--load_colour#id#)'
    html += '" >' + config#id#.load.daily.text + '</text>'
    
    html += '<text id="daily_grid_buy#id#" x="5" y="282.1" class="st3#id# left-align#id#" fill="'
    html += (config#id#.grid.daily.show_buy !== true) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '" >' + config#id#.grid.daily.text_buy + '</text>'
    
    html += '<text id="daily_grid_sell#id#" x="5" y="179" class="st3#id# left-align#id#" fill="'
    html += (config#id#.grid.daily.show_sell !== true) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '" >' + config#id#.grid.daily.text_sell + '</text>'
    
    html += '<text id="daily_solar#id#" x="200" y="40" class="st3#id# left-align#id#" fill="'
    html += (config#id#.solar.daily.show !== true || config#id#.show_solar === false || config#id#.solar.daily.remaining_show != false) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '">' + config#id#.solar.daily.text + '</text>'
    
    html += '<text id="remaining_solar#id#" x="200" y="40" class="st3#id#" fill="'
    html += (config#id#.solar.daily.show !== true || config#id#.show_solar === false || config#id#.solar.daily.remaining_show === false) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '" >' + config#id#.solar.daily.text_left + '</text>'
    
    html += '<text x="'
    html += (config#id#.solar.mppts == 1) ? '244' : '192'
    html += '" y="94" class="st3#id# st8#id# left-align#id#" display="'
    html += (config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + config#id#.solar.pv1_name + '</text>'
    
    html += '<text x="294" y="94" class="st3#id# st8#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + config#id#.solar.pv2_name + '</text>'
    
    html += '<text x="118" y="94" class="st3#id# st8#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + config#id#.solar.pv3_name + '</text>'
    
    html += '<text x="368" y="94" class="st3#id# st8#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + config#id#.solar.pv4_name + '</text>'
    
    html += '<text id="autarkye_value#id#" x="130" y="260" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.autarky === 'energy') ? 'st4#id# st8#id# left-align#id#' : 'st12#id#'
    html += '" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.autarky_state + '%</text>'
    
    html += '<text id="ratioe_value#id#" x="173" y="260" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.autarky === 'energy') ? 'st4#id# st8#id# left-align#id#' : 'st12#id#'
    html += '" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.ratio_state + '%</text>'
    
    html += '<text id="autarkyp_value#id#" x="130" y="260" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.autarky === 'power') ? 'st4#id# st8#id# left-align#id#' : 'st12#id#'
    html += '" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.autarkyp_state + '%</text>'
    
    html += '<text id="ratiop_value#id#" x="173" y="260" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.autarky === 'power') ? 'st4#id# st8#id# left-align#id#' : 'st12#id#'
    html += '" fill="var(--inverter_colour#id#)" >'  + config#id#.inverter.ratiop_state + '%</text>'
    
    html += '<text id="autarky#id#" x="130" y="273" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.autarky_text + '</text>'
    
    html += '<text id="ratio#id#" x="173" y="273" display="'
    html += (config#id#.inverter.autarky === "no") ? 'none' : ''
    html += '" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.ratio_text + '</text>'
    
    html += '<text id="es-load1-name#id#" x="400" y="110" class="st3#id# left-align#id#" display="'
    html += ((config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2) && config#id#.show_solar !== false) ? '' : 'none'
    html += '" fill="var(--load_colour#id#)" >'
    //html += (config#id#.load?.load1_name ? `${config#id#.load.load1_name}` : ''}</text>
    html += (config#id#.load.load1_name) ? config#id#.load.load1_name : ''
    html += '</text>'
    
    html += '<text id="es-load2-name#id#" x="400" y="330.5" class="st3#id# left-align#id#" display="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar !== false) ? '' : 'none'
    html += '" fill="var(--load_colour#id#)" >'
    html += (config#id#.load.load2_name) ? config#id#.load.load2_name : ''
    html += '</text>'

    // html += '<circle id="standby#id#" cx="220" cy="260" r="3.5" fill="var(--inverterStateColour#id#)"/>' /////////////// Todo
    
    html += '<path id="pv1-line#id#" d="M 187 84 L 187 122 Q 187 132 195 132 L 205 132.03" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'st12#id#' : ''
    html += '" fill="none" stroke="var(--solar_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="pv1-dot#id#" cx="0" cy="0" r="3" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'st12#id#' : ''
    html += '" fill="'
    html += (parseInt(config#id#.solar.pv1_state) <= 0) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '"><animateMotion id="anim_pv1#id#" dur="' + config#id#.solar.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#pv1-line#id#"/></animateMotion></circle>'
    
    html += '<path id="pv2-line#id#" d="M 289 84.5 L 289 125 Q 289 132 282 132 L 275 132" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'st12#id#' : ''
    html += '" fill="none" stroke="var(--solar_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="pv2-dot#id#" cx="0" cy="0" r="3" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'st12#id#' : ''
    html += '" fill="'
    html += (parseInt(config#id#.solar.pv2_state) <= 0) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '"><animateMotion id="anim_pv2#id#" dur="' + config#id#.solar.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#pv2-line#id#"/></animateMotion></circle>'
    
    html += '<path id="pv3-line#id#" d="M 113 84 L 113 125 Q 113 132 120 132 L 205 132.03" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'st12#id#' : ''
    html += '" fill="none" stroke="var(--solar_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="pv3-dot#id#" cx="0" cy="0" r="3" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'st12#id#' : ''
    html += '" fill="'
    html += (parseInt(config#id#.solar.pv3_state) <= 0) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '"><animateMotion id="anim_pv3#id#" dur="' + config#id#.solar.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#pv3-line#id#"/></animateMotion></circle>'
    
    html += '<path id="pv4-line#id#" d="M 365 85 L 365 125 Q 365 132 358 132 L 275 132" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'st12#id#' : ''
    html += '" fill="none" stroke="var(--solar_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="pv4-dot#id#" cx="0" cy="0" r="3" class="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'st12#id#' : ''
    html += '" fill="'
    html += (parseInt(config#id#.solar.pv4_state) <= 0) ? 'transparent' : 'var(--solar_colour#id#)'
    html += '"><animateMotion id="anim_pv4#id#" dur="' + config#id#.solar.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#pv4-line#id#"/></animateMotion></circle>'
    
    //html += '<path id="bat-line#id#" d="M 239.23 250 L 239.21 288.03 Q 239.21 298.03 239.1 308.02 L 239 324" fill="none" stroke="var(--battery_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<path id="bat-line#id#" d="M 239.23 250 L 239.23 300" fill="none" stroke="var(--battery_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
          
          html += '<circle id="power-dot-charge#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.battery.power_state < 0 || config#id#.battery.power_state == 0 || !config#id#.battery.power_state) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '"><animateMotion id="anim_battery#id#" dur="' + config#id#.battery.animation_speed + 's" repeatCount="indefinite" keyPoints="1;0" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#bat-line#id#"/></animateMotion></circle>'
    html += '<circle id="power-dot-discharge#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.battery.power_state > 0 || config#id#.battery.power_state == 0 || !config#id#.battery.power_state) ? 'transparent' : 'var(--battery_colour#id#)'
    html += '"><animateMotion dur="' + config#id#.battery.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#bat-line#id#"/></animateMotion></circle>'
    
    html += '<path id="so-line#id#" d="'
    html += (config#id#.solar.mppts === 1) ? 'M 239.23 190 L 239.23 85' : 'M 239.23 190 L 239.22 174.02 Q 239.21 168.03 239.1 158.04 L 239 147' 
    html += '" class="'
          
    html += (config#id#.show_solar === false) ? 'st12#id#' : ''
    html += '" fill="none" stroke="var(--solar_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="so-dot#id#" cx="0" cy="0" r="3" class="'
    html += (config#id#.show_solar === false) ? 'st12#id#' : ''
    html += '" fill="'
    html += 'transparent'
    html += '"><animateMotion id="anim_pv#id#" dur="' + config#id#.solar.animation_speed + 's" repeatCount="indefinite" keyPoints="1;0" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#so-line#id#"/></animateMotion></circle>'
    
    html += '<path id="grid-line#id#" d="M 173 218.25 L 214 218" fill="none" stroke="var(--grid_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="grid-dot-buy#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.grid.power_state < 0 || config#id#.grid.power_state === 0) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '"><animateMotion id="anim_grid_buy#id#" dur="' + config#id#.grid.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#grid-line#id#"/></animateMotion></circle>'
    html += '<circle id="grid-dot-sell#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.grid.power_state > 0 || config#id#.grid.power_state === 0) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '"><animateMotion id="anim_grid_sell#id#" dur="' + config#id#.grid.animation_speed + 's" repeatCount="indefinite" keyPoints="1;0" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#grid-line#id#"/></animateMotion></circle>'
    
    html += '<path id="grid-line1#id#" d="M 103 218.25 L 64.5 218.25" fill="none" stroke="var(--grid_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="grid-dot1-buy#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.grid.power_state < 0 || config#id#.grid.power_state === 0) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '"><animateMotion id="anim_grid_buy1#id#" dur="' + config#id#.grid.animation_speed + 's" repeatCount="indefinite" keyPoints="1;0" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#grid-line1#id#"/></animateMotion></circle>'
    html += '<circle id="grid-dot1-sell#id#" cx="0" cy="0" r="3" fill="'
    html += (config#id#.grid.power_state > 0 || config#id#.grid.power_state === 0) ? 'transparent' : 'var(--grid_colour#id#)'
    html += '"><animateMotion id="anim_grid_sell1#id#" dur="' + config#id#.grid.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#grid-line1#id#"/></animateMotion></circle>'
    
    html += '<path id="es-line#id#" d="M 304 218.5 L 264.7 218.48" fill="none" stroke="var(--load_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="es-dot1#id#" cx="0" cy="0" r="3" fill="'
    html += 'transparent'
    html += '"><animateMotion id="anim_load1#id#" dur="' + config#id#.load.animation_speed + 's" repeatCount="indefinite" keyPoints="1;0" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#es-line#id#"/></animateMotion></circle>'
    
    html += '<path id="es-line1#id#" d="M 374 218.5 L 402.38 218.52" fill="none" stroke="var(--load_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<circle id="es-dot#id#" cx="0" cy="0" r="3" fill="'
    html += 'transparent'
    html += '"><animateMotion id="anim_load#id#" dur="' + config#id#.load.animation_speed + 's" repeatCount="indefinite" keyPoints="0;1" keyTimes="0;1" calcMode="linear">'
    html += '<mpath xlink:href="#es-line1#id#"/></animateMotion></circle>'
    
    html += '<path id="es-load1path#id#" d="M 441 180 L 441 147" class="'
    html += ((config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2) && config#id#.show_solar !== false) ? '' : 'st12#id#'
    html += '" fill="none" stroke="var(--load_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    //html += '<path id="es-load1" d="M 441 180 L 441 147" class="'
    //html += (config#id#.load.additional_loads === 2 && config#id#.show_solar !== false) ? '' : 'st12#id#'
    //html += '" fill="none" stroke="var(--load_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    html += '<path id="es-load2path#id#" d="M 441 290 L 441 257" class="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar !== false) ? '' : 'st12#id#'
    html += '" fill="none" stroke="var(--load_colour#id#)" stroke-width="1" stroke-miterlimit="10"  pointer-events="stroke"/>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_oven_top#id#" x="368" y="113" width="36" height="36" viewBox="0 0 32 32" opacity="'
    html += (config#id#.load.load1_icon === 'oven' && (config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2)) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M3 7.5A4.5 4.5 0 0 1 7.5 3h17A4.5 4.5 0 0 1 29 7.5v17a4.5 4.5 0 0 1-4.5 4.5h-17A4.5 4.5 0 0 1 3 24.5v-17Zm24 0A2.5 2.5 0 0 0 24.5 5h-17A2.5 2.5 0 0 0 5 7.5V11h22V7.5Zm0 17V13H5v11.5A2.5 2.5 0 0 0 7.5 27h17a2.5 2.5 0 0 0 2.5-2.5Zm-17-15a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm6 0a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3ZM23.5 8a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0ZM9 23v-6h14v6H9Zm-.5-8A1.5 1.5 0 0 0 7 16.5v7A1.5 1.5 0 0 0 8.5 25h15a1.5 1.5 0 0 0 1.5-1.5v-7a1.5 1.5 0 0 0-1.5-1.5h-15Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_oven_bottom#id#" x="368" y="287" width="36" height="36" viewBox="0 0 32 32" opacity="'
    html += (config#id#.load.load2_icon === 'oven' && config#id#.load.additional_loads === 2) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M3 7.5A4.5 4.5 0 0 1 7.5 3h17A4.5 4.5 0 0 1 29 7.5v17a4.5 4.5 0 0 1-4.5 4.5h-17A4.5 4.5 0 0 1 3 24.5v-17Zm24 0A2.5 2.5 0 0 0 24.5 5h-17A2.5 2.5 0 0 0 5 7.5V11h22V7.5Zm0 17V13H5v11.5A2.5 2.5 0 0 0 7.5 27h17a2.5 2.5 0 0 0 2.5-2.5Zm-17-15a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3Zm6 0a1.5 1.5 0 1 0 0-3a1.5 1.5 0 0 0 0 3ZM23.5 8a1.5 1.5 0 1 1-3 0a1.5 1.5 0 0 1 3 0ZM9 23v-6h14v6H9Zm-.5-8A1.5 1.5 0 0 0 7 16.5v7A1.5 1.5 0 0 0 8.5 25h15a1.5 1.5 0 0 0 1.5-1.5v-7a1.5 1.5 0 0 0-1.5-1.5h-15Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_pump_top#id#" x="368" y="113" width="36" height="36" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load1_icon === 'pump' && (config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2)) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M3 17h4.1q-.425-.425-.787-.925T5.675 15H3v2Zm9 0q2.075 0 3.538-1.463T17 12q0-2.075-1.463-3.538T12 7Q9.925 7 8.462 8.463T7 12q0 2.075 1.463 3.538T12 17Zm6.325-8H21V7h-4.1q.425.425.788.925T18.325 9ZM1 20v-8h2v1h2.075q-.05-.25-.063-.488T5 12q0-2.925 2.038-4.963T12 5h9V4h2v8h-2v-1h-2.075q.05.25.063.488T19 12q0 2.925-2.038 4.963T12 19H3v1H1Zm2-3v-2v2Zm18-8V7v2Zm-9 3Zm0 3q-.825 0-1.413-.588T10 13q0-.575.238-1.137t.912-1.613L12 9l.85 1.25q.675 1.05.913 1.613T14 13q0 .825-.588 1.413T12 15Z"/></svg>'
            
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_pump_bottom#id#" x="368" y="287" width="36" height="36" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load2_icon === 'pump' && config#id#.load.additional_loads === 2) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M3 17h4.1q-.425-.425-.787-.925T5.675 15H3v2Zm9 0q2.075 0 3.538-1.463T17 12q0-2.075-1.463-3.538T12 7Q9.925 7 8.462 8.463T7 12q0 2.075 1.463 3.538T12 17Zm6.325-8H21V7h-4.1q.425.425.788.925T18.325 9ZM1 20v-8h2v1h2.075q-.05-.25-.063-.488T5 12q0-2.925 2.038-4.963T12 5h9V4h2v8h-2v-1h-2.075q.05.25.063.488T19 12q0 2.925-2.038 4.963T12 19H3v1H1Zm2-3v-2v2Zm18-8V7v2Zm-9 3Zm0 3q-.825 0-1.413-.588T10 13q0-.575.238-1.137t.912-1.613L12 9l.85 1.25q.675 1.05.913 1.613T14 13q0 .825-.588 1.413T12 15Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_ac_top#id#" x="374" y="116" width="30" height="30" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load1_icon === 'aircon' && (config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2)) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M6.59.66c2.34-1.81 4.88.4 5.45 3.84c.43 0 .85.12 1.23.34c.52-.6.98-1.42.8-2.34c-.42-2.15 1.99-3.89 4.28-.92c1.81 2.34-.4 4.88-3.85 5.45c0 .43-.11.86-.34 1.24c.6.51 1.42.97 2.34.79c2.13-.42 3.88 1.98.91 4.28c-2.34 1.81-4.88-.4-5.45-3.84c-.43 0-.85-.13-1.22-.35c-.52.6-.99 1.43-.81 2.35c.42 2.14-1.99 3.89-4.28.92c-1.82-2.35.4-4.89 3.85-5.45c0-.43.13-.85.35-1.23c-.6-.51-1.42-.98-2.35-.8c-2.13.42-3.88-1.98-.91-4.28M5 16h2a2 2 0 0 1 2 2v6H7v-2H5v2H3v-6a2 2 0 0 1 2-2m0 2v2h2v-2H5m7.93-2H15l-2.93 8H10l2.93-8M18 16h3v2h-3v4h3v2h-3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_ac_bottom#id#" x="374" y="289" width="30" height="30" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load2_icon === 'aircon' && config#id#.load.additional_loads === 2) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M6.59.66c2.34-1.81 4.88.4 5.45 3.84c.43 0 .85.12 1.23.34c.52-.6.98-1.42.8-2.34c-.42-2.15 1.99-3.89 4.28-.92c1.81 2.34-.4 4.88-3.85 5.45c0 .43-.11.86-.34 1.24c.6.51 1.42.97 2.34.79c2.13-.42 3.88 1.98.91 4.28c-2.34 1.81-4.88-.4-5.45-3.84c-.43 0-.85-.13-1.22-.35c-.52.6-.99 1.43-.81 2.35c.42 2.14-1.99 3.89-4.28.92c-1.82-2.35.4-4.89 3.85-5.45c0-.43.13-.85.35-1.23c-.6-.51-1.42-.98-2.35-.8c-2.13.42-3.88-1.98-.91-4.28M5 16h2a2 2 0 0 1 2 2v6H7v-2H5v2H3v-6a2 2 0 0 1 2-2m0 2v2h2v-2H5m7.93-2H15l-2.93 8H10l2.93-8M18 16h3v2h-3v4h3v2h-3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_boiler_top#id#" x="371" y="113" width="36" height="36" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load1_icon === 'boiler' && (config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2)) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M9.3 10.775q0 .475.163.925t.462.825q.05-.3.2-.588t.375-.487L12 10l1.475 1.475q.225.2.375.475t.2.575q.275-.375.487-.8t.213-.9q0-.475-.15-.913t-.45-.812q-.275.125-.563.2T13 9.375q-.75 0-1.375-.425t-.95-1.125q-.3.3-.55.637t-.438.713Q9.5 9.55 9.4 9.95t-.1.825ZM12 12.1l-.425.425q-.1.1-.138.2t-.037.225q0 .25.175.4t.425.15q.25 0 .425-.15t.175-.4q0-.125-.037-.225t-.138-.2L12 12.1ZM12 5v1.9q0 .425.3.713t.725.287q.275 0 .5-.162t.4-.388l.175-.25q1.025.575 1.588 1.563t.562 2.162q0 1.75-1.25 2.963T12 15q-1.75 0-2.975-1.225T7.8 10.8q0-1.925 1.225-3.425T12 5ZM6 22q-.825 0-1.413-.588T4 20V6q0-1.65 1.175-2.825T8 2h8q1.65 0 2.825 1.175T20 6v14q0 .825-.588 1.413T18 22H6Zm0-4v2h12v-2q-.75 0-1.2.5T15 19q-1.35 0-1.763-.5T12 18q-.825 0-1.238.5T9 19q-1.35 0-1.763-.5T6 18Zm3-1q.825 0 1.238-.5T12 16q1.35 0 1.8.5t1.2.5q.75 0 1.2-.5T18 16V6q0-.825-.588-1.413T16 4H8q-.825 0-1.413.588T6 6v10q1.35 0 1.763.5T9 17Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="ess_boiler_bottom#id#" x="371" y="287" width="36" height="36" viewBox="0 0 24 24" opacity="'
    html += (config#id#.load.load2_icon === 'boiler' && config#id#.load.additional_loads === 2) ? '1' : '0'
    html += '"><path display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)" d="M9.3 10.775q0 .475.163.925t.462.825q.05-.3.2-.588t.375-.487L12 10l1.475 1.475q.225.2.375.475t.2.575q.275-.375.487-.8t.213-.9q0-.475-.15-.913t-.45-.812q-.275.125-.563.2T13 9.375q-.75 0-1.375-.425t-.95-1.125q-.3.3-.55.637t-.438.713Q9.5 9.55 9.4 9.95t-.1.825ZM12 12.1l-.425.425q-.1.1-.138.2t-.037.225q0 .25.175.4t.425.15q.25 0 .425-.15t.175-.4q0-.125-.037-.225t-.138-.2L12 12.1ZM12 5v1.9q0 .425.3.713t.725.287q.275 0 .5-.162t.4-.388l.175-.25q1.025.575 1.588 1.563t.562 2.162q0 1.75-1.25 2.963T12 15q-1.75 0-2.975-1.225T7.8 10.8q0-1.925 1.225-3.425T12 5ZM6 22q-.825 0-1.413-.588T4 20V6q0-1.65 1.175-2.825T8 2h8q1.65 0 2.825 1.175T20 6v14q0 .825-.588 1.413T18 22H6Zm0-4v2h12v-2q-.75 0-1.2.5T15 19q-1.35 0-1.763-.5T12 18q-.825 0-1.238.5T9 19q-1.35 0-1.763-.5T6 18Zm3-1q.825 0 1.238-.5T12 16q1.35 0 1.8.5t1.2.5q.75 0 1.2-.5T18 16V6q0-.825-.588-1.413T16 4H8q-.825 0-1.413.588T6 6v10q1.35 0 1.763.5T9 17Z"/></svg>'
    
          /*
    html += '<g display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.show_solar === false) ? 'none' : ''
    html += '"><foreignObject x="371" y="114" width="36" height="36" style="position: fixed; " ><body xmlns="http://www.w3.org/1999/xhtml" ><div style="position: fixed; "><ha-icon icon="'
    html += load1e_icon
    html += '" class="essload-icon#id#" ></ha-icon></div></body></foreignObject></g>'
    
    html += '<g display="'
    html += (config#id#.load.additional_loads === 0 || config#id#.load.additional_loads === 1 || config#id#.show_solar === false) ? 'none' : ''
    html += '"><foreignObject x="371" y="288" width="36" height="36" style="position:fixed; " ><body xmlns="http://www.w3.org/1999/xhtml" ><div style="position: fixed; "><ha-icon icon="'
    html += load2e_icon
    html += '" class="essload-icon#id#" ></ha-icon></div></body></foreignObject></g>'
*/
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="icon_sun#id#" x="154" y="10" width="40" height="40" viewBox="0 0 24 24"><path class="'          
    html += (config#id#.show_solar === false) ? 'st12#id#' : ''
    html += '" fill="var(--solar_colour#id#)" d="M11.45 2v3.55L15 3.77L11.45 2m-1 6L8 10.46l3.75 1.25L10.45 8M2 11.45L3.77 15l1.78-3.55H2M10 2H2v8c.57.17 1.17.25 1.77.25c3.58.01 6.49-2.9 6.5-6.5c-.01-.59-.1-1.18-.27-1.75m7 20v-6h-3l5-9v6h3l-5 9Z"/></svg>'
          
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="icon_bat#id#" x="213" y="325.5" width="78.75" height="78.75" preserveAspectRatio="none" opacity="1" viewBox="0 0 24 24">'
          //232.5
    html += getBatteryIcon#id#(parseInt(config#id#.battery.soc.state), config#id#.battery.full_capacity, config#id#.battery.empty_capacity)
    html += '</svg>'
          
          //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.grid_connected_status_194)}>
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="transmission_on#id#" x="-0.5" y="187.5" width="64.5" height="64.5" viewBox="0 0 24 24"><path class="'
    html += (config#id#.grid.status === 'off' || config#id#.grid.status === '0' || config#id#.grid.status === 0) ? 'st12#id#' : ''
    html += '" fill="var(--grid_colour#id#)" d="m8.28 5.45l-1.78-.9L7.76 2h8.47l1.27 2.55l-1.78.89L15 4H9l-.72 1.45M18.62 8h-4.53l-.79-3h-2.6l-.79 3H5.38L4.1 10.55l1.79.89l.73-1.44h10.76l.72 1.45l1.79-.89L18.62 8m-.85 14H15.7l-.24-.9L12 15.9l-3.47 5.2l-.23.9H6.23l2.89-11h2.07l-.36 1.35L12 14.1l1.16-1.75l-.35-1.35h2.07l2.89 11m-6.37-7l-.9-1.35l-1.18 4.48L11.4 15m3.28 3.12l-1.18-4.48l-.9 1.36l2.08 3.12Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="transmission_off#id#" x="-0.5" y="187.5" width="64.5" height="64.5" viewBox="0 0 24 24"><path class="'
    html += (config#id#.grid.status === 'on' || config#id#.grid.status === '1' || config#id#.grid.status === 1) ? 'st12#id#' : ''
    html += '" fill="var(--no_grid_colour#id#)" d="M22.1 21.5L2.4 1.7L1.1 3l5 5h-.7l-1.3 2.5l1.8.9l.7-1.4h1.5l1 1l-2.9 11h2.1l.2-.9l3.5-5.2l3.5 5.2l.2.9h2.1l-.8-3.2l3.9 3.9l1.2-1.2M9.3 18.1l1.2-4.5l.9 1.3l-2.1 3.2m5.4 0L12.6 15l.2-.3l1.3 1.3l.6 2.1m-.5-7.1h.7l.2.9l-.9-.9m-.1-3h4.5l1.3 2.6l-1.8.9l-.7-1.5h-4.2l-3-3l.5-2h2.6l.8 3M8.4 5.2L6.9 3.7L7.8 2h8.5l1.3 2.5l-1.8.9L15 4H9l-.6 1.2Z"/></svg>'
    //</a>
    
    //html += '<svg xmlns="http://www.w3.org/2000/svg" id="essen#id#" x="402" y="177.5" width="79" height="79" viewBox="0 0 24 24"><path fill="var(--load_colour#id#)" d="M15 9h1V7.5h4V9h1c.55 0 1 .45 1 1v11c0 .55-.45 1-1 1h-6c-.55 0-1-.45-1-1V10c0-.55.45-1 1-1m1 2v3h4v-3h-4m-4-5.31l-5 4.5V18h5v2H5v-8H2l10-9l2.78 2.5H14v1.67l-.24.1L12 5.69Z"/></svg>'
          
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="noness#id#" x="402" y="177.5" width="79" height="79" viewBox="0 0 24 24"><path fill="var(--load_colour#id#)" d="m15 13l-4 4v-3H2v-2h9V9l4 4M5 20v-4h2v2h10v-7.81l-5-4.5L7.21 10H4.22L12 3l10 9h-3v8H5Z"></path></svg>'
    
    html += '<svg version="1.0" xmlns="http://www.w3.org/2000/svg" x="213.5" y="179.5" width="54" height="79" viewBox="0 0 74 91"  preserveAspectRatio="xMidYMid meet"> '
    html += '<g transform="translate(0.000000,91.000000) scale(0.100000,-0.100000)" fill="var(--inverter_colour#id#)" stroke="none"> <path d="M35 887 l-27 -23 0 -404 0 -404 27 -23 c26 -23 28 -23 329 -23 284 0 305 1 327 19 l24 19 0 412 0 412 -24 19 c-22 18 -43 19 -327 19 -301 0 -303 0 -329 -23z m585 -157 l0 -80 -255 0 -255 0 0 80 0 80 255 0 255 0 0 -80z m-242 -229 c44 -34 40 -46 -14 -46 -60 0 -97 -38 -93 -94 5 -64 -23 -80 -35 -20 -9 44 24 113 63 134 35 18 34 15 21 50 -11 29 -14 30 58 -24z m110 -129 c4 -51 -19 -97 -59 -117 -27 -14 -30 -20 -23 -48 l6 -31 -51 43 c-29 24 -49 46 -46 49 3 4 23 5 44 3 58 -4 95 32 97 95 3 60 1 57 17 52 6 -3 13 -23 15 -46z"/> </g> </svg>'
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.use_timer_248)}>
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="timer#id#" x="267.7" y="243.3" width="18" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.timer.state == 'on' && config#id#.timer.usetimer !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)" d="M15 1H9v2h6V1zm-4 13h2V8h-2v6zm8.03-6.61l1.42-1.42c-.43-.51-.9-.99-1.41-1.41l-1.42 1.42A8.962 8.962 0 0 0 12 4c-4.97 0-9 4.03-9 9s4.02 9 9 9a8.994 8.994 0 0 0 7.03-14.61zM12 20c-3.87 0-7-3.13-7-7s3.13-7 7-7s7 3.13 7 7s-3.13 7-7 7z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="timer_off#id#" x="267.7" y="243.3" width="18" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.timer.state == 'off' && config#id#.timer.usetimer !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)" d="m19.95 17.15l-1.5-1.5q.275-.675.413-1.337T19 13q0-2.9-2.05-4.95T12 6q-.6 0-1.275.125t-1.4.4l-1.5-1.5q.95-.5 2.012-.763T12 4q1.5 0 2.938.5t2.712 1.45l1.4-1.4l1.4 1.4l-1.4 1.4q.95 1.275 1.45 2.713T21 13q0 1.05-.263 2.087t-.787 2.063ZM13 10.2V8h-2v.2l2 2Zm6.8 12.4l-2.4-2.4q-1.2.875-2.588 1.338T12 22q-1.85 0-3.488-.713T5.65 19.35q-1.225-1.225-1.938-2.863T3 13q0-1.5.463-2.888T4.8 7.6L1.4 4.2l1.4-1.4l18.4 18.4l-1.4 1.4ZM12 20q1.05 0 2.05-.325t1.875-.925L6.2 9.025q-.6.875-.9 1.875T5 13q0 2.9 2.05 4.95T12 20ZM9 3V1h6v2H9Zm2.075 10.875Zm2.825-2.8Z"/></svg>'
    
    html += '<text id="timer_text_off#id#" x="287" y="254.7" class="st3#id# left-align#id#" display="'
    html += (config#id#.timer.state == 'off' && config#id#.timer.usetimer !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)">' + config#id#.timer.text_off + '</text>'
    
    html += '<text id="timer_text_on#id#" x="287" y="254.7" class="st3#id# left-align#id#" display="'
    html += (config#id#.timer.state == 'on' && config#id#.timer.usetimer !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)">' + config#id#.timer.text_off + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.priority_load_243)}>
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="pbat#id#" x="267.7" y="262.5" width="18" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.priority.state === 'off' && config#id#.priority.usepriority !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)" d="M15.95 21.175L13.1 18.35l1.425-1.4l1.425 1.4l3.525-3.525l1.425 1.4l-4.95 4.95ZM8 22q-.425 0-.713-.288T7 21V5q0-.425.288-.713T8 4h2V2h4v2h2q.425 0 .713.288T17 5v7q-.525 0-1.025.088T15 12.35V6H9v14h2.35q.2.575.488 1.075t.687.925H8Zm1-2h2.35H11h.35H9Z"/></svg>'
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="pload#id#" x="267.7" y="262.5" width="18" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.priority.state === 'on' && config#id#.priority.usepriority !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)" d="m15 13l-4 4v-3H2v-2h9V9l4 4M5 20v-4h2v2h10v-7.81l-5-4.5L7.21 10H4.22L12 3l10 9h-3v8H5Z"/></svg>'
    
    html += '<text id="priority_text_batt#id#" x="287" y="273" class="st3#id# left-align#id#" display="'
    html += (config#id#.priority.state === 'off' && config#id#.priority.usepriority !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)">' + config#id#.priority.text_off + '</text>'
    
    html += '<text id="priority_text_load#id#" x="287" y="273" class="st3#id# left-align#id#" display="'
    html += (config#id#.priority.state === 'on' && config#id#.priority.usepriority !== false) ? '' : 'none'
    html += '" fill="var(--inverter_colour#id#)">' + config#id#.priority.text_on + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.solar_sell_247)}>
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="solar_sell_on#id#" x="245" y="150" width="18" height="18" viewBox="0 0 30 30"><path display="'
    html += (config#id#.solar.sell === 'off' || config#id#.solar.sell === '0' || config#id#.solar.sell === 'undefined' || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" d="m5.18 5.45l-1.78-.9L4.66 2h8.47l1.27 2.55l-1.78.89L11.9 4h-6l-.72 1.45M15.5 8H11l-.8-3H7.6l-.79 3H2.28L1 10.55l1.79.89L3.5 10h10.78l.72 1.45l1.79-.89L15.5 8m-.83 14H12.6l-.24-.9l-3.46-5.2l-3.47 5.2l-.23.9H3.13L6 11h2.09l-.36 1.35L8.9 14.1l1.16-1.75L9.71 11h2.07l2.89 11M8.3 15l-.9-1.35l-1.18 4.48L8.3 15m3.28 3.12l-1.18-4.48L9.5 15l2.08 3.12M23 16l-4-4v3h-4v2h4v3l4-4Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="solar_sell_off#id#" x="245" y="150" width="18" height="18" viewBox="0 0 30 30"><path display="'
    html += (config#id#.solar.sell === 'on' || config#id#.solar.sell === '1' || config#id#.solar.sell === 'undefined' || config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" d="M 26 16 L 22 12 L 22 15 L 18 15 L 18 17 L 22 17 L 22 20 L 26 16 Z M 22.1 21.5 L 2.4 1.7 L 1.1 3 L 6.1 8 L 5.4 8 L 4.1 10.5 L 5.9 11.4 L 6.6 10 L 8.1 10 L 9.1 11 L 6.2 22 L 8.3 22 L 8.5 21.1 L 12 15.9 L 15.5 21.1 L 15.7 22 L 17.8 22 L 17 18.8 L 20.9 22.7 L 22.1 21.5 M 9.3 18.1 L 10.5 13.6 L 11.4 14.9 L 9.3 18.1 M 14.7 18.1 L 12.6 15 L 12.8 14.7 L 14.1 16 L 14.7 18.1 M 14.2 11 L 14.9 11 L 15.1 11.9 L 14.2 11 M 14.1 8 L 18.6 8 L 19.9 10.6 L 18.1 11.5 L 17.4 10 L 13.2 10 L 10.2 7 L 10.7 5 L 13.3 5 L 14.1 8 M 8.4 5.2 L 6.9 3.7 L 7.8 2 L 16.3 2 L 17.6 4.5 L 15.8 5.4 L 15 4 L 9 4 L 8.4 5.2 Z"/></svg>'
    //</a>
    
    html += '<image x="212" y="180" width="54" height="72" class="'
    html += (config#id#.inverter.modern === false) ? '' : 'st12#id#'
    html += '" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEYAAABvCAYAAABRjbZ6AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAuhSURBVHhe7Z1nbxNNFIXHpoReE0B0ECDRBRJ8o/wAfhZ/BL2AxCeEQKBECCEkikD0GkjoJZRA6C3Br5/rHGez7Ngbex0bZ4+08nrKnXvP3Ds7OzNOMt+/f8+5PH79+uX6+vrcx48f7T6Tybhx48aRNSYwZcoUN3v2bDdt2jT7nvn27VsOMl69euV+//5thORyxtWYw/jx493ixYvd9OnTXfbPnz+ut7fX9ff3GyljEbKbSHn27Jn78uWLy+ZDyeW9pmIvyWaz9gnB9QYGokelXo8t1Pv69avL/vjxww0MDAxmjRwocuzYMXfkyBHzunoBozBo79697saNG8UOiwvIFKF4TmRtFYoDys2ZM8fNnTs3dp1agM7FqEWLFrkJEyaMSBfqBT2M+0w+pnLPnz83hsPCgoV9oAxPr7DwfxVwYIPv4Peq0Ajji5BUB1VNTD3DJwrok4ROiXhMMyIlxoNhxCg+k4rTuGi0cAR19RgI4Yn2+vVre08DjTKQ140YPJKpd1dXl90zA2c6ziy8IWbRwXnMSPDu3TubaTKxY0JFz/MShpE/f/602ePEiRNdS0uLeQbfuXh7ZYbM+xllqU898vj+9u1bN3XqVJs0Akh6+vSpmzx5sr0B0xb3lMXLkE15ZABm8praT5o0yeRCNvnULxe25Fc8j3n//r25P4AE7iEJoRjC9+7ubnfq1KmiwRjx4sULU1rKqyyG4y0fPnxw8+bNK9aB7EuXLtmsVl507tw5u3/w4IHJuXv3rrt+/brlUR5iX7586d68eWMdcPHiRavPCoJkxEFFxNADYPny5dazIgRgEMsXKLNt2zZ7jyKNS9N2vAhC6UE8hnUQenTGjBmWRxnJgizylyxZ4mbOnOnWrVvnDh8+bO0tWLDACMYzHz16VNSD9pF/4sQJt2nTJtNx4cKFRlxcVEQMaxa48/Hjx4s9I+MFFMTFd+3a5a5evTqst7TuM2vWLCMHMpYuXWrl5S2AOtS/deuW9TzG4lEbNmxwbW1tRiZyVq9ebZ7HRR3Szp4969asWWOkVgIPMSjmf1zT+KpVq9yePXtcR0eHxT1K0yMYxkBKL+IhGNDa2uru378/7O2bniYftyeMIJhxh7ELeQLjxO7du00+4QDoFNpCD2RSfsuWLa6zs9PCHOzYscPKE3LBDosLIwaGhyqLlOA1HBh+7do1d/78ebd161br+Z6eHnflyhV75adX8QR6FLnyMMjiu1weozCQchingRXCIJg8xh96nzIMioD6AHLxMsrjdYQuetAOcrZv327tPXnyxMqPBBFPpagB6m/HogcxDgVoHENksJQNgu+Uox0uPIMBmbEDrwB4DD2ucQd5kEddiBnSsSCP/GAaIEwhVHlcyBCZPpCvTmMsM2JwZQSw7gvbra1z80WDnvI3MUCNIRBASlhRNUgenygN+MTzCCWIkaEaUKNkCaXyggjr5wNt4xyEPZ3KQ8CkoyRMHzp0yJ08edKNy/dOAQj2M02DwUajlFU+eSIFYBzuz5MNZfASvEcyShkehxQQ1s8HPPfo0aPu8uXLRdnFUIJdYpEJGINlIaTiKVAp4vZorUGoES2EEN5SDCUmXig52oo2CjGC9CmGkhRrFAUbAX/FCuSIuVqDthqpM6QP44x3EBktchoVtR1d/0HgEDYdGPyeIo9glKTEeJAS40FKjAcpMR5EEtNo84t6IPUYD+pGDK/6vLxxsZbDwnb4oky9MOrEEKIQwcVSBxcEKHyDF2VYs4E8vo8mRo0YDIMEjB2pJ6geBDErHQ3UlBgZwSfGVWOYZHCNhvfUlBjeUiv1Eh8gRaFXS9SUGJRnEA17iQZdpQeNlOEC98Hv5FO31uTUjBiRok0xgXt2GORFKieSuCefPNLY9YSIIERekLCkUTNiwsYI8hZCDAJ0ukFewFNITyNtBUd5huqI0KRRE2I0SEYBj2Efee3atbabqV0CdhBYiGfzjg27lStXWpk7d+64z58/D/M6AcJqRUzFx0BKQZOzKJn0MpvskEE5jGPXkvLsaclQvrPFyukF9p1IJz8MCCM9Cf1FfnExPGlgrE9R0gkRtnc54nHv3j0LHTwG47kIMTzl4MGD7ubNm8O8JRxWtfKaxIlB0VKDIkbiNXgBocNOpDxMgBjkbN682cpwFESbdWFiAHWj0qtB4qGE0Rga3HUU6FmIIY9dSI6aQRChxJiEJ+HG8hxCiXKUJ08yw7rynXAKelYlqFkoIRgDo0imR0mndyGDpw4noTCYgwEQQH0u7ilLPie1OAVRyiPIS9pjEiUG5ejVqJ5TGvMavIoTUDyRODqGZ9DjPI0YlCGLcy0cNeHQEWdnqFcKkh/VdiVIlBigcCkHNvEpyydk6pgHdfEovISjIPPnzy8+rchLyvBySHSMQWl6G8/xGUAoadZLWYyX4UHgVZyVYV5DnsIrCrSlRzb3lYaVdE58jJFCpYjBOzTgcqqCe0hgIObpwxgFEXgQ51XwHEgphWBblZISRuKhRM+VA4bIGDyHnoYMHtM80eQZKsN3n7cIvo6oFIkTg0dgZKmewwi9JzHwUlahojN4ykNWOaN9A341SJwYEDVmhEH4EDZ8ihDGE0KLuprXgHJEl/OmuAi2YRJJQMFPnz7ZZ7VgXACljGEMwXh6m3K8KEIE8xu+kwfB5JfyiKQ8Be/EUwUjBsYhZN++fa69vb3qxqjP5SOGdEKH46kc61L7kMEYAyGk40EKTR/ohGo9hkF///79NmeiPVCUiKIcNN64cWPJno4DSEFeKYMoQ/iIQCmkwZtPvMonAzK4VK8a8ITcuXOnW7ZsWTFsM11dXTle7cV6qZ4eKWiE0IjTo1KIsuhQDpCmkE0Katd+fYILi4gkSQH0pjwH2VEXsB7K3wcJDJcLX7VGpru7O8e7CEYkScrIQdu1N7gURLjNfEVIfUkB9SMlygOrG86bGCkxHqTEeJB/EKTcRCFlxYOUmDyinsgpMR6kxHiQHa0p9r+GLGsQ9Z/1Nh7sr5pFvdqHPQny9F1vwmFCw2kqr3TJ5IqaJqh8GEpXXd0Lwfuo9kEwHUinMJSeaW9vz7F6BkFaUZPhghrAGL0pyzDWbpXOGgrfWRIQrJGAggLt0F6YIJWXzFKQjpKP9+ttnlUDZITtCMrnngt9SaMeSw4cT8l0dHTkWGeVMaxxoHB/P0oPX1KkIgK5lM4eEaABiBG5cSAlqwUygkbyGYdULtnCJ3VIY+Uwc+HChRwJGHP69GnX1tbq1m9YT81BETQ8ZCgVg2ujUkSIMjSYHweUl05xIGIE7kkL6+LTg848c+aMecqKFSsKy63aImWljT8X0Nl5b1goAATqApTXFW4sWFbXSIFBcUkB4TZESFw9WITn58X8+QORnMmTkSORBHYJCIeWlvCSYXNPdyCCcZa1X4YSDhbYPEZssnLF4DUECGluUgAcYLuGBa7mt7pC/EUM7DHYBgfcsQgjRu4TvsYy0lDyICXGg5QYD1JiPEiJ8SAlxoOUGA9SYjxIifEgJcaDlBgPUmI8SInxICXGg5QYD1JiPEiJ8SAlxoNscAmzsN7LHbt4pXfymh32z+1EDj8B7Osr/MHyAkhv/rVfdlb5/TebjgXnyBRCiRs2nPgFxoED/1nhAsYGMfz2kr8KwDYte0u2n93T05N7/PixFbh9+/bgPzdYYN+H0NxDER7Dz5n5e+X8TpO/DpDp7e3NPXz40MJJe9EDA/pLHgVC8KggmnFrBS+RXZx2yHIEhN19Etn1L5xkgIjC8YgwKc0KHRuBIPtZDjf8Ql6/RSwUGDuEBIFz8AN49rGL/6QXcOqBf6QAIAbS9HumOETp0FEY1IdwyeDTJy/YlnpRaXQe8vmOZwflMQwMdWwhjXLYwD12BMsL5FMX2TgI4wsYRgygYYTziQDuEVoOUoTTEjQWPFzEPXLIB+TrZEGYSNJRlPQo4yGfY3GSBZBHu+gZlkc6dXXyS5A8fardApz7H6zyhGuotUz4AAAAAElFTkSuQmCC" preserveAspectRatio="none"/>'
    
    //<a href="#" @click=${(e) => this.handlePopup(e, inverter_prog.entityID)}>
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="prog_grid_on#id#" x="323" y="243" width="20" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.inverter.prog.show === false || config#id#.inverter.prog.grid === 'none') ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.prog.charge === 'none') ? 'st12#id#' : ''
    html += '" fill="var(--inverter_colour#id#)" d="M11.5 19h1v-1.85l3.5-3.5V9H8v4.65l3.5 3.5V19Zm-2 2v-3L6 14.5V9q0-.825.588-1.413T8 7h1L8 8V3h2v4h4V3h2v5l-1-1h1q.825 0 1.413.588T18 9v5.5L14.5 18v3h-5Zm2.5-7Z"/></svg>'
    
    html += '<svg xmlns="http://www.w3.org/2000/svg" id="prog_grid_off#id#" x="323" y="243" width="20" height="18" viewBox="0 0 24 24"><path display="'
    html += (config#id#.inverter.prog.show === false || config#id#.inverter.prog.grid === 'none') ? 'none' : ''
    html += '" class="'
    html += (config#id#.inverter.prog.charge === 'none') ? '' : 'st12#id#'
    html += '" fill="var(--inverter_colour#id#)" d="M10 3H8v1.88l2 2zm6 6v3.88l1.8 1.8l.2-.2V9c0-1.1-.9-2-2-2V3h-2v4h-3.88l2 2H16zM4.12 3.84L2.71 5.25L6 8.54v5.96L9.5 18v3h5v-3l.48-.48l4.47 4.47l1.41-1.41L4.12 3.84zm8.38 13.33V19h-1v-1.83L8 13.65v-3.11l5.57 5.57l-1.07 1.06z"/></svg>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_battery_charge_70)}>
    html += '<text id="daily_bat_charge_value#id#" x="135" y="343" class= "st10#id# left-align#id#" display="' // 77.2
    html += (config#id#.battery.daily.show_charge !== true) ? 'none' : ''
    html += '" fill="var(--battery_colour#id#)">'
    let dailyBatteryCharge = autoValueArray#id#(config#id#.battery.daily.charge_state,config#id#.battery.daily.charge_unite)
    html += dailyBatteryCharge.value.toFixed(1) + ' ' + dailyBatteryCharge.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_pv_energy_108)}>
    let dailySolar = autoValueArray#id#(config#id#.solar.daily.state,config#id#.solar.daily.unite)
    let dailyRemainingSolar = autoValueArray#id#(config#id#.solar.daily.remaining_state,config#id#.solar.daily.remaining_unite)
    
          html += '<text id="daily_solar_value#id#" x="200" y="26" class="st10#id# left-align#id#" display="'
    html += (config#id#.solar.daily.show !== true || config#id#.show_solar === false || config#id#.solar.daily.remaining_show != false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">'
    html += dailySolar.value.toFixed(1) + ' ' + dailySolar.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_pv_energy_108)}>
    html += '<text id="remaining_solar_value#id#" x="200" y="26" class="st10#id# left-align#id#" display="'
    html += (config#id#.solar.daily.show !== true || config#id#.show_solar === false || config#id#.solar.daily.remaining_show === false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + dailySolar.value.toFixed(1) + ' ' + dailySolar.unit + ' / '  + dailyRemainingSolar.value.toFixed(1) + ' ' + dailyRemainingSolar.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_battery_discharge_71)}>
    html += '<text id="daily_bat_discharge_value#id#" x="135" y="380.1" class="st10#id# left-align#id#" display="' //77.2
    html += (config#id#.battery.daily.show_discharge !== true) ? 'none' : ''
    html += '" fill="var(--battery_colour#id#)" >'
    let dailyBatteryDischarge = autoValueArray#id#(config#id#.battery.daily.discharge_state,config#id#.battery.daily.discharge_unite)
    html += dailyBatteryDischarge.value.toFixed(1) + ' ' + dailyBatteryDischarge.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_load_energy_84)}>
    html += '<text id="daily_load_value#id#" x="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar === true) ? '365' : '400.4'
    html += '" y="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar === true) ? '168' : '267.9'
    html += '" class="st10#id# left-align#id#" display="'
    html += (config#id#.load.daily.show === false) ? 'none' : ''
    html += '" fill="var(--load_colour#id#)">'
    let dailyLoad = autoValueArray#id#(config#id#.load.daily.state,config#id#.load.daily.unite)
    html += dailyLoad.value.toFixed(1) + ' ' + dailyLoad.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_grid_import_76)}>
    html += '<text id="daily_grid_buy_value#id#" x="5" y="267.9" class="st10#id# left-align#id#" display="'
    html += (config#id#.grid.daily.show_buy !== true) ? 'none' : ''
    html += '" fill="var(--grid_colour#id#)">'
    let dailyGridBuy = autoValueArray#id#(config#id#.grid.daily.buy_state,config#id#.grid.daily.buy_unite)
    html += dailyGridBuy.value.toFixed(1) + ' ' + dailyGridBuy.unit
    html += '</text>'      
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.day_grid_export_77)}>
    html += '<text id="daily_grid_sell_value#id#" x="5" y="165" class="st10#id# left-align#id#" display="'
    html += (config#id#.grid.daily.show_sell !== true) ? 'none' : ''
    html += '" fill="var(--grid_colour#id#)" >'
    let dailyGridSell = autoValueArray#id#(config#id#.grid.daily.sell_state,config#id#.grid.daily.sell_unite)
    html += dailyGridSell.value.toFixed(1) + ' ' + dailyGridSell.unit
    html += '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.inverter_voltage_154)}>
    html += '<text id="inverter_voltage#id#" x="270.2" y="168.2" display="'
    html += (config#id#.inverter.voltage_state === false) ? 'none' : ''
    html += '" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)" >' + config#id#.inverter.voltage_state + ' ' + config#id#.inverter.voltage_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.load_frequency_192)}>
    html += '<text id="inverter_frequency#id#" x="270.2" y="180.4" display="'
    html += (config#id#.inverter.frequency_state === false) ? 'none' : ''
    html += '" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)">' + config#id#.inverter.frequency_state + ' ' + config#id#.inverter.frequency_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.inverter_current_164)}>
    html += '<text id="inverter_current#id#" x="270.2" y="192.6" display="'
    html += (config#id#.inverter.current_state === false) ? 'none' : ''
    html += '" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)">' + config#id#.inverter.current_state + ' ' + config#id#.inverter.current_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_voltage_183)}>
    //html += '<text id="battery_voltage#id#" x="305" y="365" display="' // 193 346
    html += '<text id="battery_voltage#id#" x="230" y="285" display="' // 193 346
    html += (!config#id#.battery.voltage_state) ? 'none' : ''
    html += '" fill=var(--battery_colour#id#) class="'
    //html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    //html += ' st8#id# center-align#id#">' + config#id#.battery.voltage_state + ' ' + config#id#.battery.voltage_unite + '</text>'
    html += 'st3#id# right-align#id#">' + config#id#.battery.voltage_state + ' ' + config#id#.battery.voltage_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_soc_184)}>
    html += '<text id="battery_soc#id#" x="270" y="360" display="' //290 358
    html += (config#id#.battery.soc.show === false) ? 'none' : ''
    html += '" fill=var(--battery_colour#id#) class="st13#id# st8#id# left-align#id#"></text>' // parseInt(config#id#.battery.soc.state) + '%'
    //</a>
    
          /*
    let battery_soc_184 = ''
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_soc_184)}>
    html += '<text id="battery_soc2#id#" x="355" y="358" fill=var(--battery_colour#id#) class="st13#id# st8#id# left-align#id#" display="'
    html += (config#id#.inverter.prog.show === false || config#id#.battery.soc.state === 'none') ? 'none' : ''
    //html += '"> | ' + inverter_prog.capacity || 0 %</text>
    html += '"> | ' + config#id#.inverter.prog.capacity + ' %</text>'
    //</a>
    */
    
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_power_190)}>
          /*
    html += '<text id="battery_power#id#" x="305" y="395" display="' // 193 386
    html += (!config#id#.battery.power_state) ? 'none' : ''
    html += '" fill=var(--battery_colour#id#) class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#">'
    */
    html += '<text id="battery_power#id#" x="238.8" y="320" display="' // 193 386
    //html += (!config#id#.battery.power_state) ? 'none' : ''
    html += '" fill=var(--battery_colour#id#) class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#">'      
          
          
    html += (config#id#.battery.power_state < 0) ? config#id#.battery.power_state * -1 : config#id#.battery.power_state
    html += ' ' + config#id#.battery.power_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_current_191)}>
    //html += '<text id="battery_current#id#" x="305" y="380" display="' //193 365.3
    html += '<text id="battery_current#id#" x="230" y="295" display="'
    html += (!config#id#.battery.current_state) ? 'none' : ''
    html += '" fill=var(--battery_colour#id#) class="'
    //html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    //html += ' st8#id# center-align#id#">' + config#id#.battery.current_state + ' ' + config#id#.battery.current_unite + '</text>'
    html += ' st3#id# right-align#id#">' + config#id#.battery.current_state + ' ' + config#id#.battery.current_unite + '</text>'
    //</a>
    
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.grid_ct_power_172)}>
    html += '<text id="grid_power#id#" x="138.1" y="222.2" display="'
    //html += (config#id#.grid.power_state === 'none') ? 'none' : ''
    html += '" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" fill="var(--grid_colour#id#)">'
    //let gridPower = autoValueArray#id#(config#id#.grid.power_state,config#id#.grid.power_unite)
    //html += Math.abs(gridPower.value.toFixed(1)) + ' ' + gridPower.unit
    html += config#id#.grid.power_state.toFixed(0) + ' ' + config#id#.grid.power_unite
    html += '</text>'
    //</a>
    
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv1_voltage_109)}>
    html += '<text id="pv1_voltage#id#" x="194" y="106" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv1_voltage || pv1_voltage === 'none') ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv1_voltage_state + ' V</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv1_current_110)}>
    html += '<text id="pv1_current#id#" x="194" y="94" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv1_current) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv1_current_state + ' A</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv2_voltage_111)}>
    html += '<text id="pv2_voltage#id#" x="296" y="106" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv2_voltage || config#id#.solar.mppts === 1) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv2_voltage_state + ' V</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv2_current_112)}>
    html += '<text id="pv2_current#id#" x="296" y="94" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv2_current || config#id#.solar.mppts === 1) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv2_current_state + ' A</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv3_voltage_113)}>
    html += '<text id="pv3_voltage#id#" x="120" y="106" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv3_voltage || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv3_voltage_state + ' V</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv3_current_114)}>
    html += '<text id="pv3_current#id#" x="120" y="94" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv3_current || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv3_current_state + ' A</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv4_voltage_115)}>
    html += '<text id="pv4_voltage#id#" x="372" y="106" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv4_voltage || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv4_voltage_state + ' V</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.pv4_current_116)}>
    html += '<text id="pv4_current#id#" x="372" y="94" class="st3#id# left-align#id#" display="'
    html += (config#id#.show_solar === false || !pv4_current || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)" >' + pv4_current_state + ' A</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.battery_temp_182)}>
    //html += '<text id="battery_temp#id#" x="250" y="324.5" class="st3#id# left-align#id#" fill="var(--battery_colour#id#)" display="'
   html += '<text id="battery_temp#id#" x="245" y="295" class="st3#id# left-align#id#" fill="var(--battery_colour#id#)" display="'
    html += (config#id#.battery.temp.show !== false) ? '' : 'none'
    html += '" >' + config#id#.battery.temp.state + '' + config#id#.battery.temp.unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.radiator_temp_91)}>
    html += '<text id="ac_temp#id#" x="173" y="168.2" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)" display="'
    html += (config#id#.inverter.temp.ac_state !== false) ? '' : 'none'
    html += '" >AC: ' + parseFloat(config#id#.inverter.temp.ac_state).toFixed(1) + config#id#.inverter.temp.ac_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.dc_transformer_temp_90)}>
    html += '<text id="dc_temp#id#" x="173" y="180.4" class="st3#id# left-align#id#" fill="var(--inverter_colour#id#)" display="'
    html += (config#id#.inverter.temp.dc_state !== false) ? '' : 'none'
    html += '" >DC: ' + parseFloat(config#id#.inverter.temp.dc_state).toFixed(1) + config#id#.inverter.temp.dc_unite + '</text>'
    //</a>
    
    //<a href="#" @click=${(e) => this.handlePopup(e, config#id#.entities.energy_cost)}>
    html += '<text id="energy_cost#id#" x="105" y="195" class="st3#id# left-align#id#" fill="var(--grid_colour#id#)"'
    html += (config#id#.grid.energy_cost === false) ? ' display="none"' : ''
    html += ' >' + parseFloat(config#id#.grid.energy_cost).toFixed(2) + '€</text>'
    //</a>
    
    html += '<text id="pvtotal_power#id#" x="238.8" y="136" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts == 1) ? 'none' : ''
    //html += '" fill="var(--solar_colour#id#)">' + total_pv + ' ' + config#id#.solar.unite + '</text>'
    html += '" fill="var(--solar_colour#id#)"></text>'
    
    html += '<text id="pv1_power_state#id#" x="'
    html += (config#id#.solar.mppts == 1) ? '238.8' : '188.1'
    html += '" y="74" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" display="'
    html += (config#id#.show_solar === false) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + parseFloat(config#id#.solar.pv1_state).toFixed(0) + ' ' + config#id#.solar.unite + '</text>'
    
    html += '<text id="pv2_power_state#id#" x="289.5" y="74" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + parseFloat(config#id#.solar.pv2_state).toFixed(0) + ' ' + config#id#.solar.unite + '</text>'
    
    html += '<text id="pv3_power_state#id#" x="113" y="74" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + parseFloat(config#id#.solar.pv3_state).toFixed(0) + ' ' + config#id#.solar.unite + '</text>'
    
    html += '<text id="pv4_power_state#id#" x="366" y="74" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" display="'
    html += (config#id#.show_solar === false || config#id#.solar.mppts === 1 || config#id#.solar.mppts === 2 || config#id#.solar.mppts === 3) ? 'none' : ''
    html += '" fill="var(--solar_colour#id#)">' + parseFloat(config#id#.solar.pv4_state).toFixed(0) + ' ' + config#id#.solar.unite + '</text>'
    
    html += '<text id="ess_power#id#" x="338.1" y="222.2" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" fill="var(--load_colour#id#)"></text>'
    
    html += '<text id="ess_load1#id#" x="440" y="136" display="'
    html += ((config#id#.load.additional_loads === 1 || config#id#.load.additional_loads === 2) && config#id#.show_solar !== false) ? '' : 'none'
    html += '" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" fill="var(--load_colour#id#)">' + parseFloat(config#id#.load.load1_state).toFixed(0) + ' ' + config#id#.load.load1_unite + '</text>'
    
    html += '<text id="ess_load2#id#" x="440" y="309.5" display="'
    html += (config#id#.load.additional_loads === 2 && config#id#.show_solar !== false) ? '' : 'none'
    html += '" class="'
    html += (config#id#.large_font !== true) ? 'st14#id#' : 'st4#id#'
    html += ' st8#id# center-align#id#" fill="var(--load_colour#id#)">' + parseFloat(config#id#.load.load2_state).toFixed(0) + ' ' + config#id#.load.load2_unite + '</text>'
            
          html += '</svg></div>'
          document.getElementById('widget#id#').innerHTML = html
        }
        
      } // ElDomExist
      if (debug#id#) console.log('└──────────────────────────────────────────────────────')
      calculatePv#id#('init');
      calculateLoad#id#('init');
      calculateBattery#id#('init')
      calculateGrid#id#('init')
      //calculateDuration#id#('init')
    }
    
    function calculatePv#id#(el='') {
      if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] en debug [calculatePv()] ───────────────')
      var ElDomExist = !!document.getElementById("widget#id#");
      if (debug#id#) console.log("| ElDomExist ?",ElDomExist);
      if (ElDomExist) {  
        if (el != '' && debug#id#) console.log('| launched by ' + el)
        
        
        
        let total_pv = (
          parseInt(parseFloat(config#id#.solar.pv1_state || '0').toFixed(0)) +
          parseInt(parseFloat(config#id#.solar.pv2_state || '0').toFixed(0)) +
          parseInt(parseFloat(config#id#.solar.pv3_state || '0').toFixed(0)) +
          parseInt(parseFloat(config#id#.solar.pv4_state || '0').toFixed(0))
        );
        
        let solar_animation_speed = config#id#.solar.animation_speed;
        if (debug#id#) console.log('| animation_speed = ' + config#id#.solar.animation_speed)
        if (debug#id#) console.log('| max power = ' + config#id#.solar.max_power)
        let speed = config#id#.solar.animation_speed - ((config#id#.solar.animation_speed - 1.5) * (total_pv / (config#id#.solar.max_power || total_pv)));
        speed = (speed >= 1.5) ? speed : 1.5;
        document.getElementById("anim_pv#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_pv1#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_pv2#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_pv3#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_pv4#id#")?.setAttribute("dur",speed);
        
        if (debug#id#) console.log('| animation_speed = ' + speed);
        
        if (debug#id#) console.log('| total_pv = ' + total_pv);
        document.getElementById("pvtotal_power#id#").innerHTML = total_pv + ' ' + config#id#.solar.unite
        
        if(config#id#.solar.pv1_state >= 1) document.getElementById("pv1-dot#id#").setAttribute("fill", "var(--solar_colour#id#)");
        else document.getElementById("pv1-dot#id#").setAttribute("fill", "transparent");
        if(config#id#.solar.pv2_state >= 1) document.getElementById("pv2-dot#id#").setAttribute("fill", "var(--solar_colour#id#)");
        else document.getElementById("pv2-dot#id#").setAttribute("fill", "transparent");
        if(config#id#.solar.pv3_state >= 1) document.getElementById("pv3-dot#id#").setAttribute("fill", "var(--solar_colour#id#)");
        else document.getElementById("pv3-dot#id#").setAttribute("fill", "transparent");
        if(config#id#.solar.pv4_state >= 1) document.getElementById("pv4-dot#id#").setAttribute("fill", "var(--solar_colour#id#)");
        else document.getElementById("pv4-dot#id#").setAttribute("fill", "transparent");
        if(total_pv > 0) document.getElementById("so-dot#id#").setAttribute("fill", "var(--solar_colour#id#)");
        else document.getElementById("so-dot#id#").setAttribute("fill", "transparent");
        
      }
      if (debug#id#) console.log('└──────────────────────────────────────────────────────')
    }
    
    
    function calculateLoad#id#(el='') {
      if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] en debug [calculateLoad()] ───────────────')
      var ElDomExist = !!document.getElementById("widget#id#");
      if (debug#id#) console.log("| ElDomExist ?",ElDomExist);
      if (ElDomExist) {  
        
        if (el != '' && debug#id#) console.log('| launched by ' + el)
        if (debug#id#) console.log('| has_load_power ?',config#id#.load.has_load_power);
        
        if (config#id#.load.has_load_power !== false && el == 'init'){
          document.getElementById("ess_power#id#").innerHTML = parseInt(parseFloat(config#id#.load.load_state).toFixed(0)) + ' ' + config#id#.load.load_unite
        }
        
        if (config#id#.load.has_load_power === false){
          if (config#id#.load.load_unite == '') {
            if (config#id#.load.load1_unite != '') config#id#.load.load_unite = config#id#.load.load1_unite
          }
          
          if (debug#id#) console.log('| load1_state = ' + parseInt(parseFloat(config#id#.load.load1_state).toFixed(0)));
          if (debug#id#) console.log('| load2_state = ' + parseInt(parseFloat(config#id#.load.load2_state).toFixed(0)));
          if (config#id#.load.load1_unite != config#id#.load.load2_unite) console.log('| /!\\ ------- Attention unité differente entre load1 et load2, calcul impossible !!!')
          else {
            config#id#.load.load_state = parseInt(parseFloat(config#id#.load.load1_state).toFixed(0)) + parseInt(parseFloat(config#id#.load.load2_state).toFixed(0))
            document.getElementById("ess_power#id#").innerHTML = config#id#.load.load_state + ' ' + config#id#.load.load_unite
          }
        }
        
        if (debug#id#) console.log('| total_load = ' + config#id#.load.load_state);
        
        if(config#id#.load.load_state > 0) {
          document.getElementById("es-dot1#id#").setAttribute("fill", "var(--load_colour#id#)");
          document.getElementById("es-dot#id#").setAttribute("fill", "var(--load_colour#id#)");
        }
        else {
          document.getElementById("es-dot1#id#").setAttribute("fill", "transparent");
          document.getElementById("es-dot#id#").setAttribute("fill", "transparent");
        }
        if (debug#id#) console.log('| animation_speed = ' + config#id#.load.animation_speed)
        if (debug#id#) console.log('| max_power = ' + config#id#.load.max_power)
        let speed = config#id#.load.animation_speed - ((config#id#.load.animation_speed - 1) * (config#id#.load.load_state / (config#id#.load.max_power || config#id#.load.load_state)));
        speed = (speed >= 1) ? speed : 1;
        if (debug#id#) console.log('| animation_speed = ' + speed);
        document.getElementById("anim_load#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_load1#id#")?.setAttribute("dur",speed);
        
      }
      if (debug#id#) console.log('└──────────────────────────────────────────────────────')
    }
    
    
    function calculateBattery#id#(el='') {
      
      if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] en debug [calculateBattery()] ───────────────')
      var ElDomExist = !!document.getElementById("widget#id#");
      if (debug#id#) console.log("| ElDomExist ?",ElDomExist);
      if (ElDomExist) {
        if (el != '' && debug#id#) console.log('| launched by ' + el)
        
        if (el == 'init' || el == 'battery state'){
          document.getElementById("icon_bat#id#").innerHTML = getBatteryIcon#id#(config#id#.battery.soc.state, config#id#.battery.full_capacity, config#id#.battery.empty_capacity)
          document.getElementById("battery_soc#id#").innerHTML = parseInt(config#id#.battery.soc.state) + '%'
        }
        
        if (debug#id#) console.log('| animation_speed = ' + config#id#.battery.animation_speed)
        if (debug#id#) console.log('| energie = ' + config#id#.battery.energy)
        
        let speed = config#id#.battery.animation_speed - ((config#id#.battery.animation_speed - 1.5) * ((config#id#.battery.power_state < 0 ? config#id#.battery.power_state * -1 : config#id#.battery.power_state) / (config#id#.battery.energy || (config#id#.battery.power_state < 0 ? config#id#.battery.power_state * -1 : config#id#.battery.power_state))));
        speed = (speed >= 1.5) ? speed : 1.5;
        document.getElementById("anim_battery#id#")?.setAttribute("dur",speed);
        if (debug#id#) console.log('| animation_speed = ' + speed);
        
        if (debug#id#) console.log('| ----------- battery_capacity & time --------------')
        
        //calculate battery capacity
        let battery_capacity = 0
        if (config#id#.battery.power_state > 0) {
          //if (config#id#.grid.status == 0 || config#id#.inverter.prog.show === false || parseInt(config#id#.battery.soc.state) <= config#id#.inverter.prog.capacity) {
            //console.log('|  1')
            battery_capacity = config#id#.battery.soc.shutdown
          //}
          //else {
            //battery_capacity = config#id#.inverter.prog.capacity;
          //}
        }
        else if (config#id#.battery.power_state < 0) {
          //if (config#id#.grid.status == 0 || config#id#.inverter.prog.show === false || parseInt(config#id#.battery.soc.state) >= config#id#.inverter.prog.capacity) {
            battery_capacity = 100
          //} else if (parseInt(config#id#.battery.soc.state) < config#id#.inverter.prog.capacity) {
            //battery_capacity = config#id#.inverter.prog.capacity
          //}
        }
        if (debug#id#) console.log('| battery_capacity = ' + battery_capacity)
        if (debug#id#) console.log('| config#id#.battery.soc.state = ' + config#id#.battery.soc.state)
        
        //calculate remaining battery time to charge or discharge
        let totalSeconds = 0
        let formattedResultTime = ""
        let duration = ""
        
        //let power_state = (config#id#.battery.power_state < 0) ? config#id#.battery.power_state * -1 : config#id#.battery.power_state
        if (config#id#.battery.energy !== false && config#id#.battery.energy > 0) {
          if (config#id#.battery.power_state == 0) {
            if (debug#id#) console.log('| power_state == 0')
            totalSeconds = (((parseInt(config#id#.battery.soc.state) - config#id#.battery.soc.shutdown) / 100) * config#id#.battery.energy) / 1 * 60 * 60;
          } else if (config#id#.battery.power_state > 0) {
            if (debug#id#) console.log('| power_state > 0')
            totalSeconds = (((parseInt(config#id#.battery.soc.state) - battery_capacity) / 100) * config#id#.battery.energy) / config#id#.battery.power_state * 60 * 60;
            if (debug#id#) console.log('| energie restante = ' + ((parseInt(config#id#.battery.soc.state) - battery_capacity) / 100) * config#id#.battery.energy)
          } else if (config#id#.battery.power_state < 0) {
            if (debug#id#) console.log('| power_state < 0')
            totalSeconds = ((((battery_capacity - parseInt(config#id#.battery.soc.state)) / 100) * config#id#.battery.energy) / config#id#.battery.power_state) * 60 * 60 * -1;
            if (debug#id#) console.log('| energie restante = ' + ((battery_capacity - parseInt(config#id#.battery.soc.state)) / 100) * config#id#.battery.energy)
          }
          if (debug#id#) console.log('| totalSeconds = ' + totalSeconds)
          
          const currentTime = new Date(); // Create a new Date object representing the current time
          const durationMilliseconds = totalSeconds * 1000; // Convert the duration to milliseconds
          const resultTime = new Date(currentTime.getTime() + durationMilliseconds); // Add the duration in milliseconds
          const resultHours = resultTime.getHours(); // Get the hours component of the resulting time
          const resultMinutes = resultTime.getMinutes(); // Get the minutes component of the resulting time
          const formattedMinutes = resultMinutes.toString().padStart(2, "0");
          const formattedHours = resultHours.toString().padStart(2, "0");
          formattedResultTime = formattedHours + 'h' + formattedMinutes
          if (debug#id#) console.log('| formatted = ' + formattedResultTime)
          const days = Math.floor(totalSeconds / (60 * 60 * 24));
          const hours = Math.floor((totalSeconds % (60 * 60 * 24)) / (60 * 60));
          const minutes = Math.floor((totalSeconds % (60 * 60)) / 60);
          if (days > 0) {
            duration += days
            duration += (hours <= 1) ? ' jour, ' : ' jours, '
          }
          if (hours > 0 || days > 0) {
            duration += hours
            duration += (hours <= 1) ? ' hr, ' : ' hrs, '
          }
          duration +=  minutes + ' min'
          if (debug#id#) console.log('| duration= ' + duration)
          //config#id#.battery.duration = duration
          
          if (float !== true && config#id#.battery.energy !== 0 && config#id#.battery.energy !== false) {
            if (config#id#.battery.power_state == 0 || config#id#.battery.power_state == '0' || duration == '0 min') {
              document.getElementById("duration#id#").innerHTML = ''
              document.getElementById("duration_text_etat#id#").innerHTML = ''
            }
            else {
              document.getElementById("duration#id#").innerHTML = duration
              if (config#id#.battery.power_state <= 0) document.getElementById("duration_text_etat#id#").innerHTML = 'TO ' + battery_capacity + '% CHARGE @ ' + formattedResultTime
              //if (config#id#.battery.power_state >= 0) document.getElementById("duration_text_etat#id#").innerHTML = 'RUNTIME TO ' + battery_capacity+ '% @' + formattedResultTime
              if (config#id#.battery.power_state >= 0) document.getElementById("duration_text_etat#id#").innerHTML = 'RUNTIME TO ' + battery_capacity+ '% @ ' + formattedResultTime
            }
          }
          if(timer_in#id# === false) {
            if (debug#id#) console.log('| initialisation de la tempo')
            timer_in#id# = setInterval(calculateBattery#id#, 30000, 'timer_in')
          }
          else {
            if (debug#id#) console.log('| delete de la tempo & reinitialisation')
            clearInterval(timer_in#id#)
            timer_in#id# === false
            timer_in#id# = setInterval(calculateBattery#id#, 30000, 'timer_in')
          }
        }
      } // ElDomExist
      ///////////////////////////////////////////////////////////////////////// 
      if (debug#id#) console.log('└──────────────────────────────────────────────────────')
    }
    
    function calculateGrid#id#(el='') {
      if (debug#id#) console.log('┌─────────────────── Widget Distribution Onduleur [#id#] en debug [calculateGrid()] ───────────────')
      var ElDomExist = !!document.getElementById("widget#id#");
      if (debug#id#) console.log("| ElDomExist ?",ElDomExist);
      if (ElDomExist) {
        
        if (debug#id#) console.log('| animation_speed = ' + config#id#.grid.animation_speed)
        if (debug#id#) console.log('| max_power = ' + config#id#.grid.max_power)
        if (debug#id#) console.log('| power_state = ' + config#id#.grid.power_state)
        
        let speed = config#id#.grid.animation_speed - ((config#id#.grid.animation_speed - 1.5) * ((config#id#.grid.power_state < 0 ? config#id#.grid.power_state * -1 : config#id#.grid.power_state) / (config#id#.grid.max_power || (config#id#.grid.power_state < 0 ? config#id#.grid.power_state * -1 : config#id#.grid.power_state))));
        speed = (speed >= 1.5) ? speed : 1.5;
        document.getElementById("anim_grid_buy#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_grid_sell#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_grid_buy1#id#")?.setAttribute("dur",speed);
        document.getElementById("anim_grid_sell1#id#")?.setAttribute("dur",speed);
        if (debug#id#) console.log('| animation_speed = ' + speed);
      }
      if (debug#id#) console.log('└──────────────────────────────────────────────────────')
    }
      
  </script>
  <template>
    <div> ------------ Général -------------</div>
    <div>Background : Couleur arrière plan du widget [ Exemple : #fffff, white, linear-gradient... | Défaut : transparent ]</div>
    <div> ------------ Solar ------------</div>
    <div>pv1Name : personnalisation du nom du Pv1. (Ex: Ouest, Nord, PV1 ...)</div>
    <div>pv2Name : personnalisation du nom du Pv2. (Ex: Ouest, Nord, PV2 ...)</div>
    <div>pv3Name : personnalisation du nom du Pv3. (Ex: Ouest, Nord, PV3 ...)</div>
    <div>pv4Name : personnalisation du nom du Pv4. (Ex: Ouest, Nord, PV4 ...)</div>
    <div>dailySolarText : personnalisation du texte. (défaut : DAILY SOLAR)</div>
    <div>pvMaxPower : Puissance max des PV. (permet la gestion de vitesse de l'animation)</div>
    
    <div> ------------ Load ------------</div>
    <div>load1Name : personnalisation du nom du Load1. (Ex: C.E, Clim, ...)</div>
    <div>load2Name : personnalisation du nom du Load2. (Ex: C.E, Clim, ....)</div>
    <div>dailyLoadText : personnalisation du texte. (défaut : DAILY LOAD)</div>
    <div>loadMaxPower : Puissance max des équipements "Load". (permet la gestion de vitesse de l'animation)</div>
    <div> ------------ Grid ------------</div>
    <div>dailyGridSellText : personnalisation du texte. (défaut : DAILY GRID SELL)</div>
    <div>dailyGridBuyText : personnalisation du texte. (défaut : DAILY GRID BUYL)</div>
    <div>gridMaxPower : Puissance max de consommation. (permet la gestion de vitesse de l'animation)</div>
    <div> ------------ Battery ------------</div>
    <div>dailyBatteryChargeText : personnalisation du texte. (défaut : DAILY CHARGE)</div>
    <div>dailyBatteryDischargeText : personnalisation du texte. (défaut : DAILY DISCHARGE)</div>
    <div>batteryMaxPower : Puissance max de la batterie. (permet la gestion de vitesse de l'animation)</div>    
  </template>
</div>